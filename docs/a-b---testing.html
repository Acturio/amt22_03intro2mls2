<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 8 A / B - testing | AMAT- Ciencia de Datos y Machine Learning 2</title>
  <meta name="description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 8 A / B - testing | AMAT- Ciencia de Datos y Machine Learning 2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 8 A / B - testing | AMAT- Ciencia de Datos y Machine Learning 2" />
  
  <meta name="twitter:description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  

<meta name="author" content="Karina Lizette Gamboa Puente" />
<meta name="author" content="Oscar Arturo Bringas López" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="interpretabilidad-de-modelos.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><img src="img/amat-logo.png" width="280"></a></li|
|:-:|  
<center>Ciencia de Datos y Machine Learning 2</center>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>BIENVENIDA</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objetivo"><i class="fa fa-check"></i>Objetivo</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructores"><i class="fa fa-check"></i>Instructores</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ciencia-de-datos-en-r"><i class="fa fa-check"></i>Ciencia de Datos en R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-curso-actual"><i class="fa fa-check"></i>Estructura del curso actual</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#alcances-del-curso"><i class="fa fa-check"></i>Alcances del curso</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#duración-y-evaluación-del-curso"><i class="fa fa-check"></i>Duración y evaluación del curso</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recursos-y-dinámica-de-clase"><i class="fa fa-check"></i>Recursos y dinámica de clase</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="repaso.html"><a href="repaso.html"><i class="fa fa-check"></i><b>1</b> Repaso</a>
<ul>
<li class="chapter" data-level="1.1" data-path="repaso.html"><a href="repaso.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="repaso.html"><a href="repaso.html#tipos-de-aprendizaje"><i class="fa fa-check"></i><b>1.2</b> Tipos de aprendizaje</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="repaso.html"><a href="repaso.html#aprendizaje-supervisado"><i class="fa fa-check"></i><b>1.2.1</b> Aprendizaje supervisado</a></li>
<li class="chapter" data-level="1.2.2" data-path="repaso.html"><a href="repaso.html#aprendizaje-no-supervisado"><i class="fa fa-check"></i><b>1.2.2</b> Aprendizaje no supervisado</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="repaso.html"><a href="repaso.html#errores-sesgo-vs-varianza"><i class="fa fa-check"></i><b>1.3</b> Errores: Sesgo vs varianza</a></li>
<li class="chapter" data-level="1.4" data-path="repaso.html"><a href="repaso.html#partición-de-datos"><i class="fa fa-check"></i><b>1.4</b> Partición de datos</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="repaso.html"><a href="repaso.html#métodos-comunes-para-particionar-datos"><i class="fa fa-check"></i><b>1.4.1</b> Métodos comunes para particionar datos</a></li>
<li class="chapter" data-level="1.4.2" data-path="repaso.html"><a href="repaso.html#conjunto-de-validación"><i class="fa fa-check"></i><b>1.4.2</b> Conjunto de validación</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="repaso.html"><a href="repaso.html#recetas-y-tratamiento-de-datos"><i class="fa fa-check"></i><b>1.5</b> Recetas y tratamiento de datos</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="repaso.html"><a href="repaso.html#pre-procesamiento-de-datos"><i class="fa fa-check"></i><b>1.5.1</b> Pre-procesamiento de datos</a></li>
<li class="chapter" data-level="1.5.2" data-path="repaso.html"><a href="repaso.html#recetas"><i class="fa fa-check"></i><b>1.5.2</b> Recetas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>2</b> Feature Engineering</a>
<ul>
<li class="chapter" data-level="2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#regresión-polinomial"><i class="fa fa-check"></i><b>2.1</b> Regresión polinomial</a></li>
<li class="chapter" data-level="2.2" data-path="feature-engineering.html"><a href="feature-engineering.html#análisis-de-componentes-principales"><i class="fa fa-check"></i><b>2.2</b> Análisis de Componentes Principales</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#eigenvalores-y-eigenvectores"><i class="fa fa-check"></i><b>2.2.1</b> Eigenvalores y eigenvectores</a></li>
<li class="chapter" data-level="2.2.2" data-path="feature-engineering.html"><a href="feature-engineering.html#implementación-en-r"><i class="fa fa-check"></i><b>2.2.2</b> Implementación en R</a></li>
<li class="chapter" data-level="2.2.3" data-path="feature-engineering.html"><a href="feature-engineering.html#representación-gráfica"><i class="fa fa-check"></i><b>2.2.3</b> Representación gráfica</a></li>
<li class="chapter" data-level="2.2.4" data-path="feature-engineering.html"><a href="feature-engineering.html#cuántas-componentes-retener"><i class="fa fa-check"></i><b>2.2.4</b> ¿Cuántas componentes retener?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="feature-engineering.html"><a href="feature-engineering.html#imputación-knn"><i class="fa fa-check"></i><b>2.3</b> Imputación KNN</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="feature-engineering.html"><a href="feature-engineering.html#ventajas-y-limitaciones-del-clasificador-knn"><i class="fa fa-check"></i><b>2.3.1</b> <strong>Ventajas y limitaciones del Clasificador KNN</strong></a></li>
<li class="chapter" data-level="2.3.2" data-path="feature-engineering.html"><a href="feature-engineering.html#implementación-en-r-1"><i class="fa fa-check"></i><b>2.3.2</b> Implementación en R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="feature-engineering.html"><a href="feature-engineering.html#ejercicios"><i class="fa fa-check"></i><b>2.4</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html"><i class="fa fa-check"></i><b>3</b> Support Vector Machine (SVM / SVR)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#maximum-margin-classifier"><i class="fa fa-check"></i><b>3.1</b> Maximum Margin Classifier</a></li>
<li class="chapter" data-level="3.2" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-classifiers"><i class="fa fa-check"></i><b>3.2</b> Support Vector Classifiers</a></li>
<li class="chapter" data-level="3.3" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-machine"><i class="fa fa-check"></i><b>3.3</b> Support Vector Machine</a></li>
<li class="chapter" data-level="3.4" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#el-truco-del-kernel"><i class="fa fa-check"></i><b>3.4</b> El truco del Kernel</a></li>
<li class="chapter" data-level="3.5" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-regression"><i class="fa fa-check"></i><b>3.5</b> Support Vector Regression</a></li>
<li class="chapter" data-level="3.6" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ventajas-y-desventajas"><i class="fa fa-check"></i><b>3.6</b> Ventajas y desventajas</a></li>
<li class="chapter" data-level="3.7" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ajuste-del-modelo-con-r"><i class="fa fa-check"></i><b>3.7</b> Ajuste del modelo con R</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#implementación-de-svr-en-r"><i class="fa fa-check"></i><b>3.7.1</b> Implementación de SVR en R</a></li>
<li class="chapter" data-level="3.7.2" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#implementación-de-svm-en-r"><i class="fa fa-check"></i><b>3.7.2</b> Implementación de SVM en R</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ejercicios-1"><i class="fa fa-check"></i><b>3.8</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bagging-boosting.html"><a href="bagging-boosting.html"><i class="fa fa-check"></i><b>4</b> Bagging &amp; Boosting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bagging-boosting.html"><a href="bagging-boosting.html#aprendizaje-conjunto"><i class="fa fa-check"></i><b>4.1</b> Aprendizaje conjunto</a></li>
<li class="chapter" data-level="4.2" data-path="bagging-boosting.html"><a href="bagging-boosting.html#bagging-vs.-boosting"><i class="fa fa-check"></i><b>4.2</b> Bagging vs. boosting</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="bagging-boosting.html"><a href="bagging-boosting.html#error-out-of-bag"><i class="fa fa-check"></i><b>4.2.1</b> Error Out-Of-Bag</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="bagging-boosting.html"><a href="bagging-boosting.html#algoritmo-bagging"><i class="fa fa-check"></i><b>4.3</b> Algoritmo Bagging</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="bagging-boosting.html"><a href="bagging-boosting.html#ventajas-y-desventajas-de-bagging"><i class="fa fa-check"></i><b>4.3.1</b> Ventajas y desventajas de bagging</a></li>
<li class="chapter" data-level="4.3.2" data-path="bagging-boosting.html"><a href="bagging-boosting.html#aplicaciónes-de-bagging"><i class="fa fa-check"></i><b>4.3.2</b> Aplicaciónes de Bagging</a></li>
<li class="chapter" data-level="4.3.3" data-path="bagging-boosting.html"><a href="bagging-boosting.html#implementación-en-r-2"><i class="fa fa-check"></i><b>4.3.3</b> Implementación en <em>R</em></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="bagging-boosting.html"><a href="bagging-boosting.html#algoritmo-boosting"><i class="fa fa-check"></i><b>4.4</b> Algoritmo Boosting</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="bagging-boosting.html"><a href="bagging-boosting.html#predicciones-de-boosting"><i class="fa fa-check"></i><b>4.4.1</b> Predicciones de <em>Boosting</em></a></li>
<li class="chapter" data-level="4.4.2" data-path="bagging-boosting.html"><a href="bagging-boosting.html#modelos-boosting"><i class="fa fa-check"></i><b>4.4.2</b> Modelos <em>Boosting</em></a></li>
<li class="chapter" data-level="4.4.3" data-path="bagging-boosting.html"><a href="bagging-boosting.html#implementación-en-r-3"><i class="fa fa-check"></i><b>4.4.3</b> Implementación en R</a></li>
<li class="chapter" data-level="4.4.4" data-path="bagging-boosting.html"><a href="bagging-boosting.html#xgboost-para-regresión"><i class="fa fa-check"></i><b>4.4.4</b> XGBoost para regresión</a></li>
<li class="chapter" data-level="4.4.5" data-path="bagging-boosting.html"><a href="bagging-boosting.html#xgboost-para-clasificación"><i class="fa fa-check"></i><b>4.4.5</b> XGBoost para clasificación</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="bagging-boosting.html"><a href="bagging-boosting.html#ejercicios-2"><i class="fa fa-check"></i><b>4.5</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html"><i class="fa fa-check"></i><b>5</b> Workflowsets &amp; Stacking</a>
<ul>
<li class="chapter" data-level="5.1" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#múltiples-recetas"><i class="fa fa-check"></i><b>5.1</b> Múltiples recetas</a></li>
<li class="chapter" data-level="5.2" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#múltiples-modelos"><i class="fa fa-check"></i><b>5.2</b> Múltiples modelos</a></li>
<li class="chapter" data-level="5.3" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#creación-de-workflowset"><i class="fa fa-check"></i><b>5.3</b> Creación de workflowset</a></li>
<li class="chapter" data-level="5.4" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#ajuste-y-evaluación-de-modelos"><i class="fa fa-check"></i><b>5.4</b> Ajuste y evaluación de modelos</a></li>
<li class="chapter" data-level="5.5" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#extracción-de-modelos"><i class="fa fa-check"></i><b>5.5</b> Extracción de modelos</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#selección-de-modelo"><i class="fa fa-check"></i><b>5.5.1</b> Selección de modelo</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#métodos-de-carrera"><i class="fa fa-check"></i><b>5.6</b> Métodos de carrera</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#optimización-anova"><i class="fa fa-check"></i><b>5.6.1</b> Optimización ANOVA</a></li>
<li class="chapter" data-level="5.6.2" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#optimización-logística"><i class="fa fa-check"></i><b>5.6.2</b> Optimización Logística</a></li>
<li class="chapter" data-level="5.6.3" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#optimización-bayesiana"><i class="fa fa-check"></i><b>5.6.3</b> Optimización Bayesiana</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#stacking"><i class="fa fa-check"></i><b>5.7</b> Stacking</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#elección-de-modelos"><i class="fa fa-check"></i><b>5.7.1</b> Elección de modelos</a></li>
<li class="chapter" data-level="5.7.2" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#ajuste-final"><i class="fa fa-check"></i><b>5.7.2</b> Ajuste final</a></li>
<li class="chapter" data-level="5.7.3" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#comparación-de-métricas"><i class="fa fa-check"></i><b>5.7.3</b> Comparación de métricas</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="workflowsets-stacking.html"><a href="workflowsets-stacking.html#ejercicios-3"><i class="fa fa-check"></i><b>5.8</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html"><i class="fa fa-check"></i><b>6</b> Sesgo e Inequidad</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#propósito-vs-error"><i class="fa fa-check"></i><b>6.1</b> Propósito Vs Error</a></li>
<li class="chapter" data-level="6.2" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#métricas"><i class="fa fa-check"></i><b>6.2</b> Métricas</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#equal-parity-or-demographic-or-statistical-parity"><i class="fa fa-check"></i><b>6.2.1</b> Equal Parity or Demographic or Statistical Parity</a></li>
<li class="chapter" data-level="6.2.2" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#proportional-parity-o-impact-parity-o-minimizing-disparate-impact"><i class="fa fa-check"></i><b>6.2.2</b> Proportional Parity o Impact Parity o Minimizing Disparate Impact</a></li>
<li class="chapter" data-level="6.2.3" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#equalized-odds"><i class="fa fa-check"></i><b>6.2.3</b> Equalized odds</a></li>
<li class="chapter" data-level="6.2.4" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#predictive-rate-parity"><i class="fa fa-check"></i><b>6.2.4</b> Predictive rate parity</a></li>
<li class="chapter" data-level="6.2.5" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#accuracy-parity"><i class="fa fa-check"></i><b>6.2.5</b> Accuracy parity</a></li>
<li class="chapter" data-level="6.2.6" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#false-negative-parity-o-equal-oppportunity"><i class="fa fa-check"></i><b>6.2.6</b> False Negative Parity o Equal Oppportunity</a></li>
<li class="chapter" data-level="6.2.7" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#false-positive-parity"><i class="fa fa-check"></i><b>6.2.7</b> False Positive Parity</a></li>
<li class="chapter" data-level="6.2.8" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#negative-predictive-value-parity"><i class="fa fa-check"></i><b>6.2.8</b> Negative predictive value parity</a></li>
<li class="chapter" data-level="6.2.9" data-path="sesgo-e-inequidad.html"><a href="sesgo-e-inequidad.html#specificity-parity"><i class="fa fa-check"></i><b>6.2.9</b> Specificity parity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html"><i class="fa fa-check"></i><b>7</b> Interpretabilidad de modelos</a>
<ul>
<li class="chapter" data-level="7.1" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#lime"><i class="fa fa-check"></i><b>7.1</b> LIME</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#proceso"><i class="fa fa-check"></i><b>7.1.1</b> Proceso</a></li>
<li class="chapter" data-level="7.1.2" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#características-principales"><i class="fa fa-check"></i><b>7.1.2</b> Características principales</a></li>
<li class="chapter" data-level="7.1.3" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#implementación-con-r"><i class="fa fa-check"></i><b>7.1.3</b> Implementación con <em>R</em></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#dalextra"><i class="fa fa-check"></i><b>7.2</b> DALEXtra</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#otros-métodos"><i class="fa fa-check"></i><b>7.2.1</b> Otros métodos</a></li>
<li class="chapter" data-level="7.2.2" data-path="interpretabilidad-de-modelos.html"><a href="interpretabilidad-de-modelos.html#consejos"><i class="fa fa-check"></i><b>7.2.2</b> Consejos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="a-b---testing.html"><a href="a-b---testing.html"><i class="fa fa-check"></i><b>8</b> A / B - testing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="a-b---testing.html"><a href="a-b---testing.html#elementos-en-riesgo"><i class="fa fa-check"></i><b>8.1</b> Elementos en riesgo</a></li>
<li class="chapter" data-level="8.2" data-path="a-b---testing.html"><a href="a-b---testing.html#costo-de-retención"><i class="fa fa-check"></i><b>8.2</b> Costo de retención</a></li>
<li class="chapter" data-level="8.3" data-path="a-b---testing.html"><a href="a-b---testing.html#diseño-experimental"><i class="fa fa-check"></i><b>8.3</b> Diseño experimental</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="a-b---testing.html"><a href="a-b---testing.html#qué-es-y-para-qué-sirve-muestreo"><i class="fa fa-check"></i><b>8.3.1</b> ¿Qué es y para qué sirve muestreo?</a></li>
<li class="chapter" data-level="8.3.2" data-path="a-b---testing.html"><a href="a-b---testing.html#muestreo-aleatorio-simple"><i class="fa fa-check"></i><b>8.3.2</b> Muestreo aleatorio simple</a></li>
<li class="chapter" data-level="8.3.3" data-path="a-b---testing.html"><a href="a-b---testing.html#muestreo-estratificado"><i class="fa fa-check"></i><b>8.3.3</b> Muestreo estratificado</a></li>
<li class="chapter" data-level="8.3.4" data-path="a-b---testing.html"><a href="a-b---testing.html#marco-de-muestreo"><i class="fa fa-check"></i><b>8.3.4</b> Marco de muestreo</a></li>
<li class="chapter" data-level="8.3.5" data-path="a-b---testing.html"><a href="a-b---testing.html#tamaño-de-muestra"><i class="fa fa-check"></i><b>8.3.5</b> Tamaño de muestra</a></li>
<li class="chapter" data-level="8.3.6" data-path="a-b---testing.html"><a href="a-b---testing.html#distribución-muestral"><i class="fa fa-check"></i><b>8.3.6</b> Distribución muestral</a></li>
<li class="chapter" data-level="8.3.7" data-path="a-b---testing.html"><a href="a-b---testing.html#probabilidades-y-factores"><i class="fa fa-check"></i><b>8.3.7</b> Probabilidades y Factores</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="a-b---testing.html"><a href="a-b---testing.html#extracción-de-muestra"><i class="fa fa-check"></i><b>8.4</b> Extracción de muestra</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="a-b---testing.html"><a href="a-b---testing.html#muestreo-aleatorio-simple-sin-remplazo"><i class="fa fa-check"></i><b>8.4.1</b> Muestreo Aleatorio Simple sin remplazo</a></li>
<li class="chapter" data-level="8.4.2" data-path="a-b---testing.html"><a href="a-b---testing.html#muestreo-estratificado-1"><i class="fa fa-check"></i><b>8.4.2</b> Muestreo estratificado</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="a-b---testing.html"><a href="a-b---testing.html#estimación-muestral"><i class="fa fa-check"></i><b>8.5</b> Estimación muestral</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="a-b---testing.html"><a href="a-b---testing.html#implementación-de-diseño-muestral"><i class="fa fa-check"></i><b>8.5.1</b> Implementación de diseño muestral</a></li>
<li class="chapter" data-level="8.5.2" data-path="a-b---testing.html"><a href="a-b---testing.html#estimación-de-resultados"><i class="fa fa-check"></i><b>8.5.2</b> Estimación de resultados</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="./"><img src="img/amat-logo.png" width="280"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AMAT- Ciencia de Datos y Machine Learning 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-b---testing" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Capítulo 8</span> A / B - testing<a href="a-b---testing.html#a-b---testing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Los modelos de machine learning en la gran mayoría de las ocasiones tienen un propósito comercial. Como científicos de datos, es nuestra responsabilidad ayudar al negocio a tomar mejores decisiones que beneficien a la empresa en donde se ha desarrollado el modelo predictivo. Particularmente, una de las aplicaciones de mayor impacto en los últimos años es la <strong>reducción del CHURN</strong></p>
<p>El churn rate o tasa de cancelación, es el <strong>porcentaje de clientes o suscriptores que dejan de utilizar los servicios que ofrece una empresa.</strong></p>
<p><img src="img/09-ab-testing/churn.png" width="600pt" height="250" style="display: block; margin: auto;" /></p>
<p>Es bastante conocido en el mundo del marketing que es mucho más caro adquirir nuevos clientes que retener a aquellos con los que ya cuenta la empresa. Es por esta razón que adicional a los esfuerzos de captar nuevos clientes se realizan esfuerzos por retener a los clientes con alta probabilidad de abandonar la empresa.</p>
<p>A partir de los modelos de machine learning que han sido estudiados en el curso para detectar la posible inclusión a una categoría (cancelación de clientes) es que se realizará en este capítulo el estudio de técnicas para cuantificar el impacto de los modelos predictivos y de las estrategias de retención.</p>
<p>Existen múltiples estrategias que surgen en las áreas de marketing para retener a los clientes. Hay una inversión muy grande de dinero que busca encontrar las mejores ideas que contribuyan a la retención. Sin embargo, <strong>poner todas estas ideas y estrategias a trabajar puede ser bastante costoso y riesgoso.</strong></p>
<ul>
<li><p>¿Qué pasa si la empresa gasta grandes cantidades de dinero en campañas publicitarias y estas no ayudan a alcanzar la meta?</p></li>
<li><p>¿Qué sucede si se le invierte mucho tiempo en refinar la estrategia y esta nunca atrae a los clientes esperados?</p></li>
</ul>
<p>Este capítulo está destinado a discutir métodos de evaluación de esas ideas, de modo que antes de comprometernos completamente con una campaña e implementarla con todos los clientes, podamos hacer pequeñas pruebas con significancia estadística para determinar cuál de ellas tiene el mejor impacto sobre los objetivos planteados.</p>
<div id="elementos-en-riesgo" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Elementos en riesgo<a href="a-b---testing.html#elementos-en-riesgo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>El primer paso es detectar a los posibles canceladores de servicios para la empresa. Esta tarea ha sido ampliamente estudiada en el curso mediante múltiples modelos predictivos, entre los que se encuentran:</p>
<ul>
<li>Regresión bernoulli (logística)</li>
<li>Regresión Ridge</li>
<li>Regresión Lasso</li>
<li>KNN</li>
<li>Árbol de decisión</li>
<li>Bagging</li>
<li>Bosque aleatorio</li>
<li>Support Vector Machine</li>
<li>Boosting</li>
<li>Stacking</li>
</ul>
<p>Recordemos que anteriormente ya se ha realizado la partición de los datos y se cuenta con varias configuraciones de cada modelo.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="a-b---testing.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb314-2"><a href="a-b---testing.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb314-3"><a href="a-b---testing.html#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb314-4"><a href="a-b---testing.html#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb314-5"><a href="a-b---testing.html#cb314-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-6"><a href="a-b---testing.html#cb314-6" aria-hidden="true" tabindex="-1"></a>telco <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/Churn.csv&quot;</span>)</span>
<span id="cb314-7"><a href="a-b---testing.html#cb314-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-8"><a href="a-b---testing.html#cb314-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb314-9"><a href="a-b---testing.html#cb314-9" aria-hidden="true" tabindex="-1"></a>telco_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(telco, <span class="at">prop =</span> .<span class="dv">70</span>)</span>
<span id="cb314-10"><a href="a-b---testing.html#cb314-10" aria-hidden="true" tabindex="-1"></a>telco_train  <span class="ot">&lt;-</span> <span class="fu">training</span>(telco_split)</span>
<span id="cb314-11"><a href="a-b---testing.html#cb314-11" aria-hidden="true" tabindex="-1"></a>telco_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(telco_split)</span>
<span id="cb314-12"><a href="a-b---testing.html#cb314-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-13"><a href="a-b---testing.html#cb314-13" aria-hidden="true" tabindex="-1"></a>svm_tune_class_result <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;models/svm_model_class.rds&quot;</span>)</span></code></pre></div>
<p>A partir de los resultados de los modelos, se realizó una priorización para determinar cuál de ellos eran los más valiosos en términos de predicción.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="a-b---testing.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(svm_tune_class_result, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">metric =</span> <span class="st">&quot;roc_auc&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 9
##     cost rbf_sigma margin .metric .estimator  mean     n std_err .config        
##    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
##  1  1.23   0.00686 -1.20  roc_auc binary     0.808     7 0.00593 Preprocessor1_…
##  2  1.02   0.0303   0.230 roc_auc binary     0.805     9 0.00529 Preprocessor1_…
##  3  1.05   0.00823  0.904 roc_auc binary     0.805     9 0.00624 Preprocessor1_…
##  4  1.14   0.0215   1.11  roc_auc binary     0.804    10 0.00505 Preprocessor1_…
##  5  1.14   0.0154  -1.91  roc_auc binary     0.803     8 0.00625 Preprocessor1_…
##  6  1.19   0.0306  -1.45  roc_auc binary     0.803    10 0.00517 Preprocessor1_…
##  7  1.06   0.0350  -1.54  roc_auc binary     0.803    10 0.00517 Preprocessor1_…
##  8  1.22   0.0360   0.552 roc_auc binary     0.803    10 0.00517 Preprocessor1_…
##  9  1.36   0.0368   0.596 roc_auc binary     0.803    10 0.00515 Preprocessor1_…
## 10  1.11   0.00676 -1.42  roc_auc binary     0.802     9 0.00670 Preprocessor1_…</code></pre>
<p>Y mediante una elección de métrica y método, se seleccionó al más valioso para re-entrenarse usando todos los datos disponibles de entrenamiento.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="a-b---testing.html#cb317-1" aria-hidden="true" tabindex="-1"></a>svm_classification_best_model <span class="ot">&lt;-</span> <span class="fu">select_best</span>(svm_tune_class_result, <span class="at">metric =</span> <span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb317-2"><a href="a-b---testing.html#cb317-2" aria-hidden="true" tabindex="-1"></a>svm_classification_best_model</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##    cost rbf_sigma margin .config               
##   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                 
## 1  1.23   0.00686  -1.20 Preprocessor1_Model043</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="a-b---testing.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1352</span>)</span>
<span id="cb319-2"><a href="a-b---testing.html#cb319-2" aria-hidden="true" tabindex="-1"></a>svm_classification_final_model <span class="ot">&lt;-</span> svm_class_workflow <span class="sc">%&gt;%</span></span>
<span id="cb319-3"><a href="a-b---testing.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(svm_classification_best_model) <span class="sc">%&gt;%</span></span>
<span id="cb319-4"><a href="a-b---testing.html#cb319-4" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">fit</span>(<span class="at">data =</span> telco_train)</span></code></pre></div>
<p>Mediante este modelo final, se realizaron las predicciones de cancelación de servicios a clientes de telecomunicaciones. Para estos clientes se cuenta con la respuesta correcta debido a que se trata de los datos de testing.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="a-b---testing.html#cb320-1" aria-hidden="true" tabindex="-1"></a>class_results <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_classification_final_model, telco_test, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb320-2"><a href="a-b---testing.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb320-3"><a href="a-b---testing.html#cb320-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Churn =</span> telco_test<span class="sc">$</span>Churn,</span>
<span id="cb320-4"><a href="a-b---testing.html#cb320-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">customerID =</span> telco_test<span class="sc">$</span>customerID) <span class="sc">%&gt;%</span> </span>
<span id="cb320-5"><a href="a-b---testing.html#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(customerID, <span class="at">.before =</span> .pred_No) <span class="sc">%&gt;%</span> </span>
<span id="cb320-6"><a href="a-b---testing.html#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Churn =</span> <span class="fu">factor</span>(Churn, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;No&#39;</span>, <span class="st">&#39;Yes&#39;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;No&#39;</span>, <span class="st">&#39;Yes&#39;</span>)))</span>
<span id="cb320-7"><a href="a-b---testing.html#cb320-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-8"><a href="a-b---testing.html#cb320-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(class_results, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    customerID .pred_No .pred_Yes Churn
##    &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;
##  1 5575-GNVDE    0.854    0.146  No   
##  2 9305-CDSKC    0.247    0.753  Yes  
##  3 6713-OKOMC    0.822    0.178  No   
##  4 7469-LKBCI    0.871    0.129  No   
##  5 9959-WOFKT    0.923    0.0771 No   
##  6 4183-MYFRB    0.547    0.453  No   
##  7 1680-VDCWW    0.855    0.145  No   
##  8 6322-HRPFA    0.920    0.0799 No   
##  9 8665-UTDHZ    0.783    0.217  Yes  
## 10 5248-YGIJN    0.950    0.0500 No</code></pre>
<p>Hasta este punto, únicamente se han calculado probabilidades y no se han tomado decisiones sobre la determinación de elementos a quienes se realizará alguna intervención de retención.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="a-b---testing.html#cb322-1" aria-hidden="true" tabindex="-1"></a>roc_auc_value <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(</span>
<span id="cb322-2"><a href="a-b---testing.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  class_results, <span class="at">truth =</span> Churn, <span class="at">estimate =</span> .pred_Yes, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb322-3"><a href="a-b---testing.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-4"><a href="a-b---testing.html#cb322-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-5"><a href="a-b---testing.html#cb322-5" aria-hidden="true" tabindex="-1"></a>pr_auc_value <span class="ot">&lt;-</span> <span class="fu">pr_auc</span>(</span>
<span id="cb322-6"><a href="a-b---testing.html#cb322-6" aria-hidden="true" tabindex="-1"></a>  class_results, <span class="at">truth =</span> Churn, <span class="at">estimate =</span> .pred_Yes, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb322-7"><a href="a-b---testing.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-8"><a href="a-b---testing.html#cb322-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-9"><a href="a-b---testing.html#cb322-9" aria-hidden="true" tabindex="-1"></a>roc_curve_data <span class="ot">&lt;-</span> <span class="fu">roc_curve</span>(</span>
<span id="cb322-10"><a href="a-b---testing.html#cb322-10" aria-hidden="true" tabindex="-1"></a>  class_results, </span>
<span id="cb322-11"><a href="a-b---testing.html#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> Churn, </span>
<span id="cb322-12"><a href="a-b---testing.html#cb322-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> .pred_Yes, </span>
<span id="cb322-13"><a href="a-b---testing.html#cb322-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span></span>
<span id="cb322-14"><a href="a-b---testing.html#cb322-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-15"><a href="a-b---testing.html#cb322-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-16"><a href="a-b---testing.html#cb322-16" aria-hidden="true" tabindex="-1"></a>roc_curve_plot <span class="ot">&lt;-</span> roc_curve_data <span class="sc">%&gt;%</span> </span>
<span id="cb322-17"><a href="a-b---testing.html#cb322-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, <span class="at">y =</span> sensitivity)) <span class="sc">+</span></span>
<span id="cb322-18"><a href="a-b---testing.html#cb322-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;lightblue&#39;</span>) <span class="sc">+</span></span>
<span id="cb322-19"><a href="a-b---testing.html#cb322-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb322-20"><a href="a-b---testing.html#cb322-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb322-21"><a href="a-b---testing.html#cb322-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;ROC Curve &quot;</span>, <span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(roc_auc_value<span class="sc">$</span>.estimate, <span class="dv">2</span>),<span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb322-22"><a href="a-b---testing.html#cb322-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb322-23"><a href="a-b---testing.html#cb322-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-24"><a href="a-b---testing.html#cb322-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-25"><a href="a-b---testing.html#cb322-25" aria-hidden="true" tabindex="-1"></a>pr_curve_data <span class="ot">&lt;-</span> <span class="fu">pr_curve</span>(</span>
<span id="cb322-26"><a href="a-b---testing.html#cb322-26" aria-hidden="true" tabindex="-1"></a>  class_results, </span>
<span id="cb322-27"><a href="a-b---testing.html#cb322-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> Churn, </span>
<span id="cb322-28"><a href="a-b---testing.html#cb322-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> .pred_Yes, </span>
<span id="cb322-29"><a href="a-b---testing.html#cb322-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span></span>
<span id="cb322-30"><a href="a-b---testing.html#cb322-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-31"><a href="a-b---testing.html#cb322-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-32"><a href="a-b---testing.html#cb322-32" aria-hidden="true" tabindex="-1"></a>pr_curve_plot <span class="ot">&lt;-</span> pr_curve_data <span class="sc">%&gt;%</span> </span>
<span id="cb322-33"><a href="a-b---testing.html#cb322-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb322-34"><a href="a-b---testing.html#cb322-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&#39;lightblue&#39;</span>) <span class="sc">+</span></span>
<span id="cb322-35"><a href="a-b---testing.html#cb322-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb322-36"><a href="a-b---testing.html#cb322-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;Precision vs Recall &quot;</span>, <span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(pr_auc_value<span class="sc">$</span>.estimate, <span class="dv">2</span>),<span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb322-37"><a href="a-b---testing.html#cb322-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb322-38"><a href="a-b---testing.html#cb322-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-39"><a href="a-b---testing.html#cb322-39" aria-hidden="true" tabindex="-1"></a>roc_curve_plot <span class="sc">+</span> pr_curve_plot</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-225-1.png" width="672" /></p>
</div>
<div id="costo-de-retención" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Costo de retención<a href="a-b---testing.html#costo-de-retención" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Supongamos que existe un presupuesto designado a retener a los clientes de una compañía de telecomunicaciones que son áltamente probables de cancelar su servicio en los siguientes 3 meses. El presupuesto asignado es de $50,000.00 dólares y el equipo el marketing aún no se decide qué ofrecer:</p>
<ol style="list-style-type: lower-alpha">
<li><p>1 mes gratis de servicio</p></li>
<li><p>1 celular gratis con valor de $100 dólares (para la empresa)</p></li>
</ol>
<p><strong>¿Cuántos clientes podrían ser intervenidos con cada uno de los posibles métodos?</strong></p>
<p>Considere los siguientes escenarios:</p>
<ol style="list-style-type: decimal">
<li><p>Todas las retenciones son mediante meses gratis de servicio.</p></li>
<li><p>Todas las retenciones son mediante el celular gratis.</p></li>
</ol>
<p><strong>Costo de promoción de servicio</strong></p>
<p>El primer escenario considera que se obsequie un mes gratis de servicio al renovar un año completo. Para cada cliente se tiene en los datos el pago mensual que realizan, por lo que es posible priorizar de alguna manera a los clientes con mayor necesidad de retención</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="a-b---testing.html#cb323-1" aria-hidden="true" tabindex="-1"></a>promo_1 <span class="ot">&lt;-</span> class_results <span class="sc">%&gt;%</span> </span>
<span id="cb323-2"><a href="a-b---testing.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb323-3"><a href="a-b---testing.html#cb323-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyCharges =</span> telco_test<span class="sc">$</span>MonthlyCharges,</span>
<span id="cb323-4"><a href="a-b---testing.html#cb323-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Expected_Loss =</span> .pred_Yes <span class="sc">*</span> MonthlyCharges) <span class="sc">%&gt;%</span> </span>
<span id="cb323-5"><a href="a-b---testing.html#cb323-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Expected_Loss)) <span class="sc">%&gt;%</span> </span>
<span id="cb323-6"><a href="a-b---testing.html#cb323-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Budget =</span> <span class="fu">cumsum</span>(MonthlyCharges)) <span class="sc">%&gt;%</span> </span>
<span id="cb323-7"><a href="a-b---testing.html#cb323-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Budget <span class="sc">&lt;=</span> <span class="dv">50000</span>)</span>
<span id="cb323-8"><a href="a-b---testing.html#cb323-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-9"><a href="a-b---testing.html#cb323-9" aria-hidden="true" tabindex="-1"></a>promo_1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Churn, <span class="sc">-</span>.pred_No)</span></code></pre></div>
<pre><code>## # A tibble: 587 × 5
##    customerID .pred_Yes MonthlyCharges Expected_Loss Budget
##    &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;
##  1 1400-MMYXY     0.964          106.          102.    106.
##  2 5419-CONWX     0.946           99.8          94.4   206.
##  3 2754-SDJRD     0.921          100.           92.2   306.
##  4 3902-FOIGH     0.905          101.           91.7   407.
##  5 6210-KBBPI     0.918           99.4          91.3   507.
##  6 4716-HHKQH     0.852          107.           91.2   614.
##  7 8510-AWCXC     0.895          101.           90.2   714.
##  8 2012-NWRPA     0.903           99.6          89.9   814.
##  9 9851-KIELU     0.816          110.           89.9   924.
## 10 9300-AGZNL     0.946           94            89.0  1018.
## # … with 577 more rows</code></pre>
<p>Sin acabarse el presupuesto de $50,000 dólares, el número de clientes a quienes es posible ofrecer la promoción es de 587/2113, lo que representa cerca del 28% de los clientes.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="a-b---testing.html#cb325-1" aria-hidden="true" tabindex="-1"></a>promo_1 <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="a-b---testing.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb325-3"><a href="a-b---testing.html#cb325-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_prob =</span> <span class="fu">min</span>(.pred_Yes),</span>
<span id="cb325-4"><a href="a-b---testing.html#cb325-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_monthly_charge =</span> <span class="fu">mean</span>(MonthlyCharges),</span>
<span id="cb325-5"><a href="a-b---testing.html#cb325-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_monthly_charge =</span> <span class="fu">sum</span>(MonthlyCharges),</span>
<span id="cb325-6"><a href="a-b---testing.html#cb325-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_yearly_charge =</span> <span class="fu">sum</span>(MonthlyCharges)<span class="sc">*</span><span class="dv">11</span></span>
<span id="cb325-7"><a href="a-b---testing.html#cb325-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   min_prob mean_monthly_charge sum_monthly_charge sum_yearly_charge
##      &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;
## 1    0.217                85.1             49960.           549557.</code></pre>
<p>Al calcular el valor mínimo de probabilidad de cancelar el servicio, se observa que <strong>el umbral se encuentra cercano a 0.20</strong>, por lo que este es un buen candidato a usar en futuros meses si se usa este método y se cuenta con tal presupuesto.</p>
<p>El gasto mensual promedio de los clientes es de $85 dólares. El costo total para la empresa es de $49,959.75 y el beneficio de invertir esta cantidad es de $549,557 dólares en un año. Este beneficio es el máximo a obtener si todos los clientes aceptaran renovar su suscripción. Será necesario realizar un experimento para comparar el beneficio neto cuando se implementa esta táctiva de marketing u alguna otra estrategia.</p>
<p><strong>Costo de promoción de producto</strong></p>
<p>El segundo método es más sencillo de calcular, pues supone un costo constante para cualquier cliente. Al regalar un producto en donde la empresa paga $100 dólares por celular, se logra ofrecer <span class="math inline">\(50000/100 = 500\)</span> productos.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="a-b---testing.html#cb327-1" aria-hidden="true" tabindex="-1"></a>promo_2 <span class="ot">&lt;-</span> class_results <span class="sc">%&gt;%</span> </span>
<span id="cb327-2"><a href="a-b---testing.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb327-3"><a href="a-b---testing.html#cb327-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyCharges =</span> telco_test<span class="sc">$</span>MonthlyCharges,</span>
<span id="cb327-4"><a href="a-b---testing.html#cb327-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Profit =</span> <span class="dv">100</span>,</span>
<span id="cb327-5"><a href="a-b---testing.html#cb327-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Expected_Loss =</span> .pred_Yes <span class="sc">*</span> MonthlyCharges) <span class="sc">%&gt;%</span> </span>
<span id="cb327-6"><a href="a-b---testing.html#cb327-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Expected_Loss)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-7"><a href="a-b---testing.html#cb327-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Budget =</span> <span class="fu">cumsum</span>(Profit)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-8"><a href="a-b---testing.html#cb327-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Budget <span class="sc">&lt;=</span> <span class="dv">50000</span>)</span>
<span id="cb327-9"><a href="a-b---testing.html#cb327-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-10"><a href="a-b---testing.html#cb327-10" aria-hidden="true" tabindex="-1"></a>promo_2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Churn, <span class="sc">-</span>.pred_No)</span></code></pre></div>
<pre><code>## # A tibble: 500 × 6
##    customerID .pred_Yes MonthlyCharges Profit Expected_Loss Budget
##    &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;
##  1 1400-MMYXY     0.964          106.     100         102.     100
##  2 5419-CONWX     0.946           99.8    100          94.4    200
##  3 2754-SDJRD     0.921          100.     100          92.2    300
##  4 3902-FOIGH     0.905          101.     100          91.7    400
##  5 6210-KBBPI     0.918           99.4    100          91.3    500
##  6 4716-HHKQH     0.852          107.     100          91.2    600
##  7 8510-AWCXC     0.895          101.     100          90.2    700
##  8 2012-NWRPA     0.903           99.6    100          89.9    800
##  9 9851-KIELU     0.816          110.     100          89.9    900
## 10 9300-AGZNL     0.946           94      100          89.0   1000
## # … with 490 more rows</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="a-b---testing.html#cb329-1" aria-hidden="true" tabindex="-1"></a>promo_2 <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="a-b---testing.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb329-3"><a href="a-b---testing.html#cb329-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_prob =</span> <span class="fu">min</span>(.pred_Yes),</span>
<span id="cb329-4"><a href="a-b---testing.html#cb329-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_monthly_charge =</span> <span class="fu">mean</span>(MonthlyCharges),</span>
<span id="cb329-5"><a href="a-b---testing.html#cb329-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_monthly_charge =</span> <span class="fu">sum</span>(MonthlyCharges),</span>
<span id="cb329-6"><a href="a-b---testing.html#cb329-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_yearly_charge =</span> <span class="fu">sum</span>(MonthlyCharges)<span class="sc">*</span><span class="dv">11</span></span>
<span id="cb329-7"><a href="a-b---testing.html#cb329-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   min_prob mean_monthly_charge sum_monthly_charge sum_yearly_charge
##      &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;
## 1    0.283                86.1             43050.           473545.</code></pre>
<p>A diferencia del primer método, el umbral de probabilidad con esta segunda campaña es cercano a 0.30, lo que implica mayor precisión a costa de menor cobertura. Adicionalmente, el beneficio total de renovación de contrato es menor que el beneficio alcanzado por el primer método en el escenario utópico en que todos los clientes renuevan.</p>
<p>Estos cálculos sirven exclusivamente para acotar los escenarios, pues no es de esperarse que realmente todos los clientes renueven sus contratos. En las siguientes secciones se procede a realizar experimentos para evaluar cuál de las campañas tiene una mayor tasa de retención de clientes.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="a-b---testing.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13582</span>)</span>
<span id="cb331-2"><a href="a-b---testing.html#cb331-2" aria-hidden="true" tabindex="-1"></a>results_promo_1 <span class="ot">&lt;-</span> promo_1 <span class="sc">%&gt;%</span> </span>
<span id="cb331-3"><a href="a-b---testing.html#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb331-4"><a href="a-b---testing.html#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb331-5"><a href="a-b---testing.html#cb331-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">result =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.40</span>),</span>
<span id="cb331-6"><a href="a-b---testing.html#cb331-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cancell =</span> <span class="fu">if_else</span>(result <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb331-7"><a href="a-b---testing.html#cb331-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>result)</span>
<span id="cb331-8"><a href="a-b---testing.html#cb331-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-9"><a href="a-b---testing.html#cb331-9" aria-hidden="true" tabindex="-1"></a>results_promo_1</span></code></pre></div>
<pre><code>## # A tibble: 587 × 8
## # Rowwise: 
##    customerID .pred_No .pred_Yes Churn MonthlyCharges Expected_Loss Budget
##    &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;
##  1 1400-MMYXY   0.0364     0.964 Yes            106.          102.    106.
##  2 5419-CONWX   0.0544     0.946 Yes             99.8          94.4   206.
##  3 2754-SDJRD   0.0789     0.921 No             100.           92.2   306.
##  4 3902-FOIGH   0.0954     0.905 Yes            101.           91.7   407.
##  5 6210-KBBPI   0.0823     0.918 Yes             99.4          91.3   507.
##  6 4716-HHKQH   0.148      0.852 No             107.           91.2   614.
##  7 8510-AWCXC   0.105      0.895 Yes            101.           90.2   714.
##  8 2012-NWRPA   0.0971     0.903 Yes             99.6          89.9   814.
##  9 9851-KIELU   0.184      0.816 Yes            110.           89.9   924.
## 10 9300-AGZNL   0.0536     0.946 Yes             94            89.0  1018.
## # … with 577 more rows, and 1 more variable: cancell &lt;chr&gt;</code></pre>
<p>Primero, analicemos el siguiente resultado, el cual corresponde a la efectividad del método de retención por descuento de mensualidad gratis.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="a-b---testing.html#cb333-1" aria-hidden="true" tabindex="-1"></a>results_promo_1 <span class="sc">%&gt;%</span> </span>
<span id="cb333-2"><a href="a-b---testing.html#cb333-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cancell) <span class="sc">%&gt;%</span> </span>
<span id="cb333-3"><a href="a-b---testing.html#cb333-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb333-4"><a href="a-b---testing.html#cb333-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb333-5"><a href="a-b---testing.html#cb333-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_monthly_charge =</span> <span class="fu">mean</span>(MonthlyCharges),</span>
<span id="cb333-6"><a href="a-b---testing.html#cb333-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_monthly_charge =</span> <span class="fu">sum</span>(MonthlyCharges),</span>
<span id="cb333-7"><a href="a-b---testing.html#cb333-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_yearly_charge =</span> <span class="fu">sum</span>(MonthlyCharges)<span class="sc">*</span><span class="dv">11</span></span>
<span id="cb333-8"><a href="a-b---testing.html#cb333-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb333-9"><a href="a-b---testing.html#cb333-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb333-10"><a href="a-b---testing.html#cb333-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(prop, <span class="at">.after =</span> n)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   cancell     n  prop mean_monthly_charge sum_monthly_charge sum_yearly_charge
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;
## 1 No        368  0.63                84.5             31111            342221 
## 2 Yes       219  0.37                86.1             18849.           207336.</code></pre>
<p>El contrafactual se refiere a una versión alternativa en la que la alteración (en este caso, método de retención) en la serie de sucesos conduce a un resultado distinto del que realmente ocurrió. En la siguiente tabla, aparecen los resultados del contrafactual (etiqueta original de Churn).</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="a-b---testing.html#cb335-1" aria-hidden="true" tabindex="-1"></a>promo_1 <span class="sc">%&gt;%</span> </span>
<span id="cb335-2"><a href="a-b---testing.html#cb335-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Churn) <span class="sc">%&gt;%</span> </span>
<span id="cb335-3"><a href="a-b---testing.html#cb335-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb335-4"><a href="a-b---testing.html#cb335-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb335-5"><a href="a-b---testing.html#cb335-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_monthly_charge =</span> <span class="fu">mean</span>(MonthlyCharges),</span>
<span id="cb335-6"><a href="a-b---testing.html#cb335-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_monthly_charge =</span> <span class="fu">sum</span>(MonthlyCharges),</span>
<span id="cb335-7"><a href="a-b---testing.html#cb335-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_yearly_charge =</span> <span class="fu">sum</span>(MonthlyCharges)<span class="sc">*</span><span class="dv">11</span></span>
<span id="cb335-8"><a href="a-b---testing.html#cb335-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb335-9"><a href="a-b---testing.html#cb335-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb335-10"><a href="a-b---testing.html#cb335-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(prop, <span class="at">.after =</span> n)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   Churn     n  prop mean_monthly_charge sum_monthly_charge sum_yearly_charge
##   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;
## 1 No      265  0.45                84.6             22413.           246546.
## 2 Yes     322  0.55                85.5             27546.           303012.</code></pre>
<p>Hay que observar que se obtiene una mejora en la tasa de cancelación (Churn) cuando se aplica el método de retención basado en descuento de mensualidad.</p>
<p><span class="math display">\[\text{diferencia} =  \$328,163 - \$246,546 = \$81,617\]</span></p>
<p><strong>Esta diferencia es el verdadero beneficio de haber implementado e invertido en ciencia de datos y machine learning</strong>.</p>
<p>Por supuesto, este resultado deberá ser mayor al esfuerzo de inversión de todo el proyecto. Quizá en la primera iteración se realiza una inversión mayor, no obstante, a lo largo del tiempo deberá ser rentable para el negocio.</p>
<p>Por supuesto, este resultado es teórico, pues es imposible conocer el contrafactual de la forma en que fue presentado anteriormente debido a que una vez que se implementa un método, se vuelve imposible conocer el resultado de haber hecho otra cosa. Este mismo problema se enfrenta en una gran cantidad de estudios médicos, sociales, de diseño de imagen corporativa, etc, por lo que las mismas técnicas estadísticas serán presentadas para dar solución a esta estimación.</p>
<div class="infobox note">
<p><strong>WHAT IF…</strong></p>
<ul>
<li><p>¿Qué pasaría si la tasa de <em>churn</em> fuese mayor a la obtenida al no implementar ninguna campaña?</p></li>
<li><p>¿Cómo sabemos que estamos maximizando las ganancias a través de la elección de la mejor campaña de retención?</p></li>
</ul>
</div>
</div>
<div id="diseño-experimental" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Diseño experimental<a href="a-b---testing.html#diseño-experimental" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sería formidable lograr conocer cuál es el mejor método de retención antes de aplicar el ejercicio de retención a todos los clientes. Esto definitivamente ayudaría a maximizar ganancias y evitar tener pérdidas con alguna mala decisión.</p>
<p>A través de la experimentación es posible estimar los resultados de diferentes escenarios. Para lograrlo, se requiere de la <strong>creación de muestras representativas de la población</strong> que simulen con cierto error tolerable el resultado de cada campaña de retención. Para realizar esta práctica es importante introducirnos al tema de: <strong>muestreo</strong>.</p>
<div id="qué-es-y-para-qué-sirve-muestreo" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> ¿Qué es y para qué sirve muestreo?<a href="a-b---testing.html#qué-es-y-para-qué-sirve-muestreo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El muestreo es el proceso de seleccionar un conjunto de individuos de una población con el fin de estudiarlos y poder caracterizar el total de la población. Nos ayuda a obtener información fiable de la población a partir de una muestra de la que extrae inferencias estadísticas con un margen de error medido en términos de probabilidades. En otras palabras, en una investigación por muestreo podremos estudiar el comportamiento y las opiniones de toda una población analizando únicamente una parte de esta, teniendo en cuenta que siempre existirá un margen de error a la hora de realizar dichos cálculos.</p>
<p><img src="img/09-ab-testing/1-1-1-muestreo.jpg" width="450pt" height="450pt" style="display: block; margin: auto;" /></p>
<p><strong>Ventajas</strong></p>
<ul>
<li><p><strong>Reducción de costos:</strong> Los costos de un estudio serán menores si los datos de interés se pueden obtener a partir de una muestra de la población. Por ejemplo, cuando se realizan estudios de prevalencia de un evento de interés, es más económico medir una muestra representativa de 1500 sujetos de una población, que el total de individuos que la componen.</p></li>
<li><p><strong>Eficiencia:</strong> Al trabajar con un número reducido de sujetos de estudio, representativos de la población; el tiempo necesario para conducir el estudio y obtener resultados y conclusiones será notoriamente menor.</p></li>
</ul>
<p>Una muestra puede ser obtenida de diferentes maneras:</p>
<ul>
<li>No probabilística.
<ul>
<li>Por cuotas</li>
<li>Conveniencia</li>
<li>Bola de nieve</li>
<li>Discrecional</li>
</ul></li>
<li>Probabilística
<ul>
<li>Aleatorio Simple</li>
<li>Sistemático</li>
<li>Estratificado</li>
<li>Conglomerados</li>
<li>Polietápico</li>
<li>Etc.</li>
</ul></li>
</ul>
<p>El temario de muestreo es largo, por lo que nuestro enfoque se centrará en el muestreo probabilístico aletorio simple y el estratificado.</p>
<p>El muestreo probabilístico se define como aquél en que todos los individuos de la población tienen una probabilidad de entrar a formar parte de la muestra. Los diseños en que interviene el azar producen muestras representativas la mayoría de las veces.</p>
</div>
<div id="muestreo-aleatorio-simple" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Muestreo aleatorio simple<a href="a-b---testing.html#muestreo-aleatorio-simple" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Se caracteriza porque <strong>cada elemento de la población tiene la misma probabilidad de ser escogido para formar parte de la muestra</strong> y todas las posibles muestras tienen la misma probabilidad de ser elegidas. Una vez censado el marco de la población, se asigna un número a cada individuo o elemento y se elige aleatoriamente.</p>
<p>Para seleccionar una muestra de este tipo se requiere tener en forma de lista todos los elementos que integran la población investigada y utilizar tablas de números aleatorios.</p>
<p>Ejemplo: A un grupo de 100 personas se les numera de uno a cien y se depositan en una urna 100 canicas a su vez numeradas de uno a cien. Para obtener una muestra aleatoria simple de 20 elementos, tendríamos que sacar 20 canicas numeradas de la urna que nos seleccionarán en forma completamente aleatoria a los 20 elementos escogidos para que opinen sobre un nuevo producto.</p>
<p><img src="img/09-ab-testing/1-1-4-tipos-de-muestreo-probabilistico-mas.png" width="250pt" height="250pt" style="display: block; margin: auto;" /></p>
</div>
<div id="muestreo-estratificado" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Muestreo estratificado<a href="a-b---testing.html#muestreo-estratificado" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En este tipo de muestreo <strong>la población de estudio se divide en subgrupos o estratos</strong>, escogiendo posteriormente una muestra al azar de cada estrato. Esta división suele realizarse según una característica que pueda influir sobre los resultados del estudio.</p>
<p>Si la estratificación se realiza respecto una característica se denomina <em>muestreo estratificado simple</em>, y si se realiza respecto a dos o más características sedenomina <em>muestreo estratificado compuesto</em>.</p>
<p>Ejemplo: Si existen 5 millones de hipertensos en una población y hay un <span class="math inline">\(35\%\)</span> de pacientes que fuman, podemos estratificar de manera que en nuestra muestra queden representados al igual que en el total de la población, la misma proporción de hipertensos fumadores (<span class="math inline">\(35\%\)</span>) y de no fumadores (<span class="math inline">\(65\%\)</span>).</p>
<p><img src="img/09-ab-testing/1-1-4-tipos-de-muestreo-probabilistico-estratificado.jpg" width="350pt" height="350pt" style="display: block; margin: auto;" /></p>
</div>
<div id="marco-de-muestreo" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Marco de muestreo<a href="a-b---testing.html#marco-de-muestreo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El primer paso consiste en crear un <strong>marco de muestreo</strong>, el cual es el <strong>listado de los posibles elementos a ser seleccionados en la muestra.</strong> Tiene la característica de que todos los elementos deben pertenecer a la población objetivo. Este marco de muestreo podría llegar a tener los siguientes 3 errores:</p>
<ul>
<li><p><strong>Duplicidad:</strong> Existen elementos repetidos</p></li>
<li><p><strong>Sobre-representatividad:</strong> Existen elementos en el marco que no pertenecen a la población objetivo</p></li>
<li><p><strong>Sub-representatividad:</strong> Existen elementos pertenecientes a la población objetivo que no se encuentran representados en el marco</p></li>
</ul>
<p>Ante estos problemas, es necesario realizar una limpieza de los datos disponibles para obtener un conjunto lo más adecuado para extraer estos problemas.</p>
</div>
<div id="tamaño-de-muestra" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Tamaño de muestra<a href="a-b---testing.html#tamaño-de-muestra" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Es imprescindible en una buena estimación conocer el tamaño de muestra adecuado que permitirá controlar o cuantificar el error de muestreo.</p>
<p>Se presenta a continuación la fórmula estadística que permite conocer el tamaño de muestra necesario para lograr con 95% de confianza (<span class="math inline">\(\alpha\)</span>) un error de muestreo (e). Esta fórmula corresponde se calcula a partir de un diseño de muestreo aleatorio simple, donde la variable de respuesta es dicotómica (sí o no):</p>
<p><span class="math display">\[m=\frac{p(1-p)Z_{1-\alpha/2}^2}{e²};\]</span></p>
<p><span class="math display">\[n=\frac{m}{1+\frac{m}{N}} \frac{deff}{(1-TNR)}\]</span></p>
<p><strong>Donde:</strong></p>
<p>N = Es el tamaño de población.</p>
<p>n = Tamaño de muestra.</p>
<p>p = Proporción esperada (50% por default).</p>
<p><span class="math inline">\(Z_{1-\alpha/2}\)</span> = Percentil <span class="math inline">\(\alpha/2\)</span> de la distribución Normal estándar.</p>
<p>e = Error de muestreo máximo a tolerar.</p>
<p>TNR = Tasa de no respuesta</p>
<p>deff = Efecto de diseño (aumento en la varianza por usar un diseño distinto al aleatorio simple)</p>
<p>Esta fórmula puede demostrarse a partir del siguiente planteamiento:</p>
<p><span class="math display">\[P[|\theta-\hat{\theta}| &lt; error] = Z_{1-\alpha/2}\]</span></p>
<p>Para mayor teoría de muestreo, consultar el libro: <a href="https://link.springer.com/book/9780387406206">Model Assisted Survey Sampling</a></p>
<div class="infobox pin">
<p><strong>¡¡ RECORDAR !!</strong></p>
<p>En la medida en que se desea disminuir el error de muestreo, es necesario incrementar de manera exponencial el tamaño de muestra.</p>
</div>
<p>Se presenta a continuación la función creada con <em>R</em> para conocer el tamaño de muestra de una población. Es necesario indicar los parámetros e hipótesis bajo los cuales se realizará dicho cálculo. Posteriormente, se presenta una gráfica que permite conocer el tamaño de muestra de acuerdo con el error de muestreo a tolerar (suponiendo fijos otros parámetros).</p>
<div id="implementación-en-r-4" class="section level4 hasAnchor" number="8.3.5.1">
<h4><span class="header-section-number">8.3.5.1</span> Implementación en R<a href="a-b---testing.html#implementación-en-r-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="a-b---testing.html#cb337-1" aria-hidden="true" tabindex="-1"></a>n_muestra <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">e =</span> <span class="fl">0.04</span>, <span class="at">p =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>, <span class="at">N =</span> <span class="dv">100000</span>, <span class="at">deff =</span> <span class="fl">1.5</span>, <span class="at">tnr =</span> <span class="fl">0.10</span>){</span>
<span id="cb337-2"><a href="a-b---testing.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb337-3"><a href="a-b---testing.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">=</span> p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span> (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span>e)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb337-4"><a href="a-b---testing.html#cb337-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">ceiling</span>( (m<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> m<span class="sc">/</span>N)) <span class="sc">*</span> deff<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span> tnr ) ) </span>
<span id="cb337-5"><a href="a-b---testing.html#cb337-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-6"><a href="a-b---testing.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(n)</span>
<span id="cb337-7"><a href="a-b---testing.html#cb337-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Ejemplo</strong></p>
<p>Suponiendo un tamaño poblacional de 4.5 millones de personas, y con 95% de confianza un error máximo a tolerar de 3.5%, el tamaño de muestra necesario para estimar una proporción es:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="a-b---testing.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_muestra</span>(<span class="at">e =</span> <span class="fl">0.035</span>, <span class="at">p =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>, <span class="at">N =</span> <span class="dv">4500000</span>, <span class="at">deff =</span> <span class="dv">1</span>, <span class="at">tnr =</span> <span class="fl">0.20</span>)</span></code></pre></div>
<pre><code>## [1] 980</code></pre>
<p>En este ejemplo, por practicidad se redondea el tamaño de la muestra a 1,00 unidades. Veamos otro ejemplo:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="a-b---testing.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_muestra</span>(<span class="at">e =</span> <span class="fl">0.04</span>, <span class="at">p =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>, <span class="at">N =</span> <span class="dv">900</span>, <span class="at">deff =</span> <span class="dv">1</span>, <span class="at">tnr =</span> <span class="fl">0.20</span>)</span></code></pre></div>
<pre><code>## [1] 451</code></pre>
<p>En este segundo caso, se redonde a 450 casos. Veamos ahora una gráfica que permita anañizar la relación existente entre el tamaño de muestra y el error de muestreo.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="a-b---testing.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb342-2"><a href="a-b---testing.html#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb342-3"><a href="a-b---testing.html#cb342-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-4"><a href="a-b---testing.html#cb342-4" aria-hidden="true" tabindex="-1"></a>tam_muestra <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">error =</span> <span class="fu">seq</span>(<span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.001</span>))</span>
<span id="cb342-5"><a href="a-b---testing.html#cb342-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-6"><a href="a-b---testing.html#cb342-6" aria-hidden="true" tabindex="-1"></a>tam_muestra <span class="sc">%&gt;%</span> </span>
<span id="cb342-7"><a href="a-b---testing.html#cb342-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n_muestra</span>(<span class="at">e =</span> error, <span class="at">p =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>, <span class="at">N =</span> <span class="dv">100000</span>, <span class="at">deff =</span> <span class="fl">1.7</span>, <span class="at">tnr =</span> <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb342-8"><a href="a-b---testing.html#cb342-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> error, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb342-9"><a href="a-b---testing.html#cb342-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb342-10"><a href="a-b---testing.html#cb342-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb342-11"><a href="a-b---testing.html#cb342-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Relación entre error de muestreo y tamaño de muestra&quot;</span>) <span class="sc">+</span></span>
<span id="cb342-12"><a href="a-b---testing.html#cb342-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Error de muestreo&quot;</span>) <span class="sc">+</span></span>
<span id="cb342-13"><a href="a-b---testing.html#cb342-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Tamaño de muestra&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-239-1.png" width="672" /></p>
<p>Ahora analizaremos la relación existente entre el tamaño de muestra y el tamaño poblacional cuando fijamos el error de muestreo en 3.5%.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="a-b---testing.html#cb343-1" aria-hidden="true" tabindex="-1"></a>tam_muestra <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">N =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100000</span>, <span class="at">by =</span> <span class="dv">1000</span>))</span>
<span id="cb343-2"><a href="a-b---testing.html#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="a-b---testing.html#cb343-3" aria-hidden="true" tabindex="-1"></a>tam_muestra <span class="sc">%&gt;%</span> </span>
<span id="cb343-4"><a href="a-b---testing.html#cb343-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n_muestra</span>(<span class="at">e =</span> <span class="fl">0.035</span>, <span class="at">N =</span> N)) <span class="sc">%&gt;%</span> </span>
<span id="cb343-5"><a href="a-b---testing.html#cb343-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> N, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb343-6"><a href="a-b---testing.html#cb343-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb343-7"><a href="a-b---testing.html#cb343-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb343-8"><a href="a-b---testing.html#cb343-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1500</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb343-9"><a href="a-b---testing.html#cb343-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Relación entre tamaño de población y tamaño de muestra&quot;</span>) <span class="sc">+</span></span>
<span id="cb343-10"><a href="a-b---testing.html#cb343-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Tamaño de población&quot;</span>) <span class="sc">+</span></span>
<span id="cb343-11"><a href="a-b---testing.html#cb343-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Tamaño de muestra&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-240-1.png" width="672" /></p>
<p>Se puede apreciar que a mayor tamaño de población es necesario una muestra más grande, sin embargo, no es un comportamiento lineal. Debido a que una de las condiciones de muestreo es que la selección es aleatoria, existe un punto de saturación de información, en donde no se necesita aumentar más el tamaño de muestra (aunque el tamaño de la población siga creciendo)</p>
<div class="infobox important">
<p><strong>¡¡ RECORDAR !!</strong></p>
<p>Para lograr estimaciones representativas de ALTA calidad sobre la población, es indispensable realizar un buen diseño de muestreo, de lo contrario los resultados pueden estar sesgados.</p>
</div>
<div class="infobox note">
<p><strong>EJERCICIO</strong></p>
<p>Realizar el cálculo del tamaño de muestra necesario para los siguientes escenarios:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Muestra representativa de alumnos de esta clase</p></li>
<li><p>Muestra de clientes probables a cancelar su servicio de telecomunicaciones con los datos vistos en clase (Test)</p></li>
</ol>
</div>
</div>
</div>
<div id="distribución-muestral" class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> Distribución muestral<a href="a-b---testing.html#distribución-muestral" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una vez que el tamaño de muestra ha sido calculado, es común que se proceda a distribuirla de una manera estratégica que permita recolectar de manera óptima la información necesaria. Existe distintos tipos de distribución (afijación), las cuales dependen de que existan estratos (grupos) de la población sobre los cuales se desea distribuir la muestra. Entre las más comunes, se encuentran:</p>
<ol style="list-style-type: decimal">
<li><strong>Afijación simple:</strong> En este tipo de afijación, la muestra se distribuye de manera igualitaria entre los distintos grupos. La fórmula es la siguiente:</li>
</ol>
<p><span class="math display">\[n_h=\frac{n}{L}\]</span>
<strong>Donde:</strong></p>
<p><span class="math inline">\(n_h=\)</span> Es el tamaño de muestra en el h-ésimo estrato</p>
<p><span class="math inline">\(n=\)</span> Es el tamaño de muestra total</p>
<p><span class="math inline">\(L=\)</span> Es el número de estratos</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Afijación proporcional:</strong> Posiblemente es el tipo de afijación más usado. Esta estrategia se usa para distribuir la muestra de manera proporcional a una característica. Por regla general, se distribuye de acuerdo con la distribución poblacional (viviendas o personas) en zonas geográficas. La fórmula es la siguiente:</li>
</ol>
<p><span class="math display">\[n_h = \frac{P_h}{P} \cdot n\]</span></p>
<p><strong>Donde:</strong></p>
<ul>
<li><p><span class="math inline">\(n_h=\)</span> Es el tamaño de muestra ajustado en el h-ésimo estrato</p></li>
<li><p><span class="math inline">\(n=\)</span> Es el tamaño de muestra global</p></li>
<li><p><span class="math inline">\(P_h=\)</span> Es la población en el h-ésimo estrato</p></li>
<li><p><span class="math inline">\(P=\)</span> Es la población total</p></li>
</ul>
<div id="implementación-en-r-5" class="section level4 hasAnchor" number="8.3.6.1">
<h4><span class="header-section-number">8.3.6.1</span> Implementación en R<a href="a-b---testing.html#implementación-en-r-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Suponga por un momento que contamos con una característica particular de interés en la que podemos clasificar a la población de clientes, puede ser el sexo, la edad, ingresos o alguna otra clasificación de interés (producto de contratación).</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="a-b---testing.html#cb344-1" aria-hidden="true" tabindex="-1"></a>marco <span class="ot">&lt;-</span> telco_test <span class="sc">%&gt;%</span> </span>
<span id="cb344-2"><a href="a-b---testing.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(customerID, gender, Contract) <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="a-b---testing.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb344-4"><a href="a-b---testing.html#cb344-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cod_gender =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(gender)),</span>
<span id="cb344-5"><a href="a-b---testing.html#cb344-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cod_contract =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(Contract)),</span>
<span id="cb344-6"><a href="a-b---testing.html#cb344-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-7"><a href="a-b---testing.html#cb344-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(estrato, <span class="fu">starts_with</span>(<span class="st">&quot;cod_&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb344-8"><a href="a-b---testing.html#cb344-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb344-9"><a href="a-b---testing.html#cb344-9" aria-hidden="true" tabindex="-1"></a>    class_results <span class="sc">%&gt;%</span> <span class="fu">select</span>(customerID, .pred_Yes)</span>
<span id="cb344-10"><a href="a-b---testing.html#cb344-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-11"><a href="a-b---testing.html#cb344-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.pred_Yes <span class="sc">&gt;=</span> <span class="fl">0.20</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;customerID&quot;</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="a-b---testing.html#cb346-1" aria-hidden="true" tabindex="-1"></a>marco</span></code></pre></div>
<pre><code>## # A tibble: 907 × 5
##    customerID gender Contract       estrato .pred_Yes
##    &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt;       &lt;dbl&gt;
##  1 9305-CDSKC Female Month-to-month 1-1         0.753
##  2 4183-MYFRB Female Month-to-month 1-1         0.453
##  3 8665-UTDHZ Male   Month-to-month 2-1         0.217
##  4 6827-IEAUQ Female One year       1-2         0.206
##  5 6047-YHPVI Male   Month-to-month 2-1         0.517
##  6 4080-IIARD Female Month-to-month 1-1         0.455
##  7 1658-BYGOY Male   Month-to-month 2-1         0.814
##  8 7410-OIEDU Male   Month-to-month 2-1         0.518
##  9 2273-QCKXA Male   Month-to-month 2-1         0.357
## 10 1891-QRQSA Male   Two year       2-3         0.210
## # … with 897 more rows</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="a-b---testing.html#cb348-1" aria-hidden="true" tabindex="-1"></a>marco <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb348-2"><a href="a-b---testing.html#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estrato) <span class="sc">%&gt;%</span> </span>
<span id="cb348-3"><a href="a-b---testing.html#cb348-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID_unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(marco))</span>
<span id="cb348-4"><a href="a-b---testing.html#cb348-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-5"><a href="a-b---testing.html#cb348-5" aria-hidden="true" tabindex="-1"></a>pob_estrato <span class="ot">&lt;-</span> marco <span class="sc">%&gt;%</span> </span>
<span id="cb348-6"><a href="a-b---testing.html#cb348-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender, Contract, estrato) <span class="sc">%&gt;%</span> </span>
<span id="cb348-7"><a href="a-b---testing.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb348-8"><a href="a-b---testing.html#cb348-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb348-9"><a href="a-b---testing.html#cb348-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_prob =</span> <span class="fu">mean</span>(.pred_Yes, <span class="at">na.rm =</span> T),</span>
<span id="cb348-10"><a href="a-b---testing.html#cb348-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb348-11"><a href="a-b---testing.html#cb348-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-12"><a href="a-b---testing.html#cb348-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_prob))</span>
<span id="cb348-13"><a href="a-b---testing.html#cb348-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-14"><a href="a-b---testing.html#cb348-14" aria-hidden="true" tabindex="-1"></a>pob_estrato</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   gender Contract       estrato     n mean_prob
##   &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1 Female Month-to-month 1-1       378     0.515
## 2 Male   Month-to-month 2-1       410     0.503
## 3 Female One year       1-2        48     0.366
## 4 Female Two year       1-3         8     0.333
## 5 Male   One year       2-2        46     0.332
## 6 Male   Two year       2-3        17     0.308</code></pre>
<p>Suponiendo que el tamaño de muestra seleccionado es de 450 individuos y se desea hacer una afijación proporcional, el tamaño de muestra en cada estrato queda asignado de la siguiente forma:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="a-b---testing.html#cb350-1" aria-hidden="true" tabindex="-1"></a>distribucion <span class="ot">&lt;-</span> pob_estrato <span class="sc">%&gt;%</span> </span>
<span id="cb350-2"><a href="a-b---testing.html#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb350-3"><a href="a-b---testing.html#cb350-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb350-4"><a href="a-b---testing.html#cb350-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_h =</span> <span class="fu">round</span>(prop <span class="sc">*</span> <span class="dv">450</span>)</span>
<span id="cb350-5"><a href="a-b---testing.html#cb350-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb350-6"><a href="a-b---testing.html#cb350-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(estrato)</span>
<span id="cb350-7"><a href="a-b---testing.html#cb350-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-8"><a href="a-b---testing.html#cb350-8" aria-hidden="true" tabindex="-1"></a>distribucion</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   gender Contract       estrato     n mean_prob    prop   n_h
##   &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt;   &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Female Month-to-month 1-1       378     0.515 0.417     188
## 2 Female One year       1-2        48     0.366 0.0529     24
## 3 Female Two year       1-3         8     0.333 0.00882     4
## 4 Male   Month-to-month 2-1       410     0.503 0.452     203
## 5 Male   One year       2-2        46     0.332 0.0507     23
## 6 Male   Two year       2-3        17     0.308 0.0187      8</code></pre>
<p><strong>De esta forma, el tamaño final de la muestra será de 450 unidades, repartidos en cada estrato como se muestra anteriormente.</strong></p>
</div>
</div>
<div id="probabilidades-y-factores" class="section level3 hasAnchor" number="8.3.7">
<h3><span class="header-section-number">8.3.7</span> Probabilidades y Factores<a href="a-b---testing.html#probabilidades-y-factores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dependiendo del diseño de muestreo implementado, a cada unidad se le deberá asignar una probabilidad de ser incluída en la muestra. Entre las más comunes se encuentran:</p>
<p><strong>Probabilidades</strong></p>
<ul>
<li>Muestreo Aleatorio Simple sin reemplazo: Ocurre cuando <strong>NO</strong> se realiza reemplazo de la muestra y un elemento es seleccionado una sola vez.</li>
</ul>
<p><span class="math display">\[\pi_k=\frac{n}{N}\]</span></p>
<p>En el caso del muestreo estratificado, el muestreo se realiza de manera aleatoria simple dentro de cada estrato, por lo que la probabilidad interna a un estrato debe ser la misma.</p>
<p><strong>Factor de expansión</strong></p>
<p>El factor de expansión se refiere al número de individuos fuera de la muestra que son representados por cada uno de los individuos incluídos dentro de la muestra, Este factor es calculado para cada elemento muestral. Matemáticamente, este cálculo se realiza a través del inverso de probabilidad de selección:</p>
<p><span class="math display">\[F_k=\frac{1}{\pi_k}\]</span></p>
<p>En <em>R</em> realizaremos automáticamente el cálculo de la probabilidad de inclusión y posteriormente invertiremos esta probabilidad para extraer el factor de expansión.</p>
</div>
</div>
<div id="extracción-de-muestra" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Extracción de muestra<a href="a-b---testing.html#extracción-de-muestra" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Una vez definido el diseño de muestreo y tamaño de muestra, procedemos a extraer nuestra muestra de acuerdo con el diseño determinado. En esta sección probaremos 2 formas de extraer la muestra final.</p>
<div id="muestreo-aleatorio-simple-sin-remplazo" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Muestreo Aleatorio Simple sin remplazo<a href="a-b---testing.html#muestreo-aleatorio-simple-sin-remplazo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El muestreo aleatorio simple sin reemplazo es uno de los más simples de implementar. Es necesario contar con la librería <em>sampling</em> para poder hacer uso de las funciones necesarias.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="a-b---testing.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb352-2"><a href="a-b---testing.html#cb352-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-3"><a href="a-b---testing.html#cb352-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">310308261</span>)</span>
<span id="cb352-4"><a href="a-b---testing.html#cb352-4" aria-hidden="true" tabindex="-1"></a>muestra_1 <span class="ot">&lt;-</span> <span class="fu">strata</span>(</span>
<span id="cb352-5"><a href="a-b---testing.html#cb352-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> marco, </span>
<span id="cb352-6"><a href="a-b---testing.html#cb352-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stratanames =</span> <span class="cn">NULL</span>, </span>
<span id="cb352-7"><a href="a-b---testing.html#cb352-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">450</span>, </span>
<span id="cb352-8"><a href="a-b---testing.html#cb352-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;srswor&quot;</span>, </span>
<span id="cb352-9"><a href="a-b---testing.html#cb352-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="cn">TRUE</span></span>
<span id="cb352-10"><a href="a-b---testing.html#cb352-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb352-11"><a href="a-b---testing.html#cb352-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## 
## Population total and number of selected units: 907 450</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="a-b---testing.html#cb354-1" aria-hidden="true" tabindex="-1"></a>muestra_1</span></code></pre></div>
<pre><code>## # A tibble: 450 × 2
##    ID_unit  Prob
##      &lt;int&gt; &lt;dbl&gt;
##  1       2 0.496
##  2       3 0.496
##  3       4 0.496
##  4       5 0.496
##  5       6 0.496
##  6       7 0.496
##  7       8 0.496
##  8      12 0.496
##  9      13 0.496
## 10      14 0.496
## # … with 440 more rows</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="a-b---testing.html#cb356-1" aria-hidden="true" tabindex="-1"></a>muestra_ponde_1 <span class="ot">&lt;-</span> marco <span class="sc">%&gt;%</span> </span>
<span id="cb356-2"><a href="a-b---testing.html#cb356-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID_unit <span class="sc">%in%</span> muestra_1<span class="sc">$</span>ID_unit) <span class="sc">%&gt;%</span> </span>
<span id="cb356-3"><a href="a-b---testing.html#cb356-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(muestra_1, <span class="at">by =</span> <span class="st">&quot;ID_unit&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="a-b---testing.html#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor =</span> <span class="dv">1</span><span class="sc">/</span>Prob)</span>
<span id="cb356-5"><a href="a-b---testing.html#cb356-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-6"><a href="a-b---testing.html#cb356-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(muestra_ponde_1)</span></code></pre></div>
<pre><code>## Rows: 450
## Columns: 8
## $ customerID &lt;chr&gt; &quot;4183-MYFRB&quot;, &quot;4080-IIARD&quot;, &quot;5919-TMRGD&quot;, &quot;8108-UXRQN&quot;, &quot;48…
## $ gender     &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;,…
## $ Contract   &lt;chr&gt; &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Mont…
## $ estrato    &lt;chr&gt; &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-…
## $ .pred_Yes  &lt;dbl&gt; 0.4527031, 0.4551335, 0.6721531, 0.2751320, 0.3955544, 0.56…
## $ ID_unit    &lt;int&gt; 2, 3, 4, 5, 6, 7, 8, 12, 13, 14, 16, 19, 20, 21, 22, 28, 32…
## $ Prob       &lt;dbl&gt; 0.4961411, 0.4961411, 0.4961411, 0.4961411, 0.4961411, 0.49…
## $ factor     &lt;dbl&gt; 2.015556, 2.015556, 2.015556, 2.015556, 2.015556, 2.015556,…</code></pre>
</div>
<div id="muestreo-estratificado-1" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Muestreo estratificado<a href="a-b---testing.html#muestreo-estratificado-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Este tipo de muestreo implica la creación previa de estratos y sus respectivas distribución por algunos de los métodos antes estudiados. Es importante mencionar que las funciones usadas para este tipo de muestreo implican que las unidades muestrales se encuentran ordenadas por estrato de modo que todos los elementos pertenecientes a un mismo estrato se encuentran juntos.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="a-b---testing.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13258</span>)</span>
<span id="cb358-2"><a href="a-b---testing.html#cb358-2" aria-hidden="true" tabindex="-1"></a>muestra_estratificada_1 <span class="ot">&lt;-</span> <span class="fu">strata</span>(</span>
<span id="cb358-3"><a href="a-b---testing.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> marco, </span>
<span id="cb358-4"><a href="a-b---testing.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stratanames =</span> <span class="st">&quot;estrato&quot;</span>,</span>
<span id="cb358-5"><a href="a-b---testing.html#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> distribucion<span class="sc">$</span>n_h,</span>
<span id="cb358-6"><a href="a-b---testing.html#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;srswor&quot;</span>, </span>
<span id="cb358-7"><a href="a-b---testing.html#cb358-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="cn">TRUE</span></span>
<span id="cb358-8"><a href="a-b---testing.html#cb358-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Stratum 1 
## 
## Population total and number of selected units: 378 188 
## Stratum 2 
## 
## Population total and number of selected units: 48 24 
## Stratum 3 
## 
## Population total and number of selected units: 8 4 
## Stratum 4 
## 
## Population total and number of selected units: 410 203 
## Stratum 5 
## 
## Population total and number of selected units: 46 23 
## Stratum 6 
## 
## Population total and number of selected units: 17 8 
## Number of strata  6 
## Total number of selected units 450</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="a-b---testing.html#cb360-1" aria-hidden="true" tabindex="-1"></a>muestra_estratificada_1 <span class="ot">&lt;-</span> marco <span class="sc">%&gt;%</span> </span>
<span id="cb360-2"><a href="a-b---testing.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID_unit <span class="sc">%in%</span> muestra_estratificada_1<span class="sc">$</span>ID_unit) <span class="sc">%&gt;%</span> </span>
<span id="cb360-3"><a href="a-b---testing.html#cb360-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(muestra_estratificada_1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID_unit&quot;</span>, <span class="st">&quot;estrato&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb360-4"><a href="a-b---testing.html#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor =</span> <span class="dv">1</span><span class="sc">/</span>Prob)</span>
<span id="cb360-5"><a href="a-b---testing.html#cb360-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-6"><a href="a-b---testing.html#cb360-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(muestra_estratificada_1)</span></code></pre></div>
<pre><code>## Rows: 450
## Columns: 9
## $ customerID &lt;chr&gt; &quot;5919-TMRGD&quot;, &quot;4412-YLTKF&quot;, &quot;7825-ECJRF&quot;, &quot;9408-SSNVZ&quot;, &quot;45…
## $ gender     &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;,…
## $ Contract   &lt;chr&gt; &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Mont…
## $ estrato    &lt;chr&gt; &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-…
## $ .pred_Yes  &lt;dbl&gt; 0.6721531, 0.5631683, 0.6510308, 0.5323239, 0.5963150, 0.83…
## $ ID_unit    &lt;int&gt; 4, 7, 10, 11, 12, 13, 14, 15, 17, 18, 21, 22, 26, 27, 29, 3…
## $ Prob       &lt;dbl&gt; 0.4973545, 0.4973545, 0.4973545, 0.4973545, 0.4973545, 0.49…
## $ Stratum    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ factor     &lt;dbl&gt; 2.010638, 2.010638, 2.010638, 2.010638, 2.010638, 2.010638,…</code></pre>
<p><strong>Finalmente…</strong> para extraer estos resultados en un archivo manipulable por nosotros u otras personas, hacemos uso de la función <em>write.csv()</em>, la cual nos permitirá almacenar nuestra muestra en formato de excel con extensión .csv:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="a-b---testing.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(muestra_estratificada_1, <span class="st">&quot;data/muestra_estratificada_1.csv&quot;</span>, <span class="at">row.names =</span> F)</span></code></pre></div>
<p>Para diseñar la muestra de otro método de marketing para incentivar la re-contratación de servicios se realiza otra extracción independiente de datos</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="a-b---testing.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">579315</span>)</span>
<span id="cb363-2"><a href="a-b---testing.html#cb363-2" aria-hidden="true" tabindex="-1"></a>muestra_estratificada_2 <span class="ot">&lt;-</span> <span class="fu">strata</span>(</span>
<span id="cb363-3"><a href="a-b---testing.html#cb363-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> marco <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>ID_unit <span class="sc">%in%</span> muestra_estratificada_1<span class="sc">$</span>ID_unit), </span>
<span id="cb363-4"><a href="a-b---testing.html#cb363-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stratanames =</span> <span class="st">&quot;estrato&quot;</span>,</span>
<span id="cb363-5"><a href="a-b---testing.html#cb363-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> distribucion<span class="sc">$</span>n_h,</span>
<span id="cb363-6"><a href="a-b---testing.html#cb363-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;srswor&quot;</span>, </span>
<span id="cb363-7"><a href="a-b---testing.html#cb363-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="cn">TRUE</span></span>
<span id="cb363-8"><a href="a-b---testing.html#cb363-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Stratum 1 
## 
## Population total and number of selected units: 190 188 
## Stratum 2 
## 
## Population total and number of selected units: 24 24 
## Stratum 3 
## 
## Population total and number of selected units: 4 4 
## Stratum 4 
## 
## Population total and number of selected units: 207 203 
## Stratum 5 
## 
## Population total and number of selected units: 23 23 
## Stratum 6 
## 
## Population total and number of selected units: 9 8 
## Number of strata  6 
## Total number of selected units 450</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="a-b---testing.html#cb365-1" aria-hidden="true" tabindex="-1"></a>muestra_estratificada_2 <span class="ot">&lt;-</span> marco <span class="sc">%&gt;%</span> </span>
<span id="cb365-2"><a href="a-b---testing.html#cb365-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID_unit <span class="sc">%in%</span> muestra_estratificada_2<span class="sc">$</span>ID_unit) <span class="sc">%&gt;%</span> </span>
<span id="cb365-3"><a href="a-b---testing.html#cb365-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(muestra_estratificada_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID_unit&quot;</span>, <span class="st">&quot;estrato&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb365-4"><a href="a-b---testing.html#cb365-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(muestra_estratificada_1 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(estrato, factor), <span class="at">by =</span> <span class="st">&quot;estrato&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb365-5"><a href="a-b---testing.html#cb365-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Prob =</span> <span class="dv">1</span><span class="sc">/</span>factor)</span>
<span id="cb365-6"><a href="a-b---testing.html#cb365-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-7"><a href="a-b---testing.html#cb365-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(muestra_estratificada_2)</span></code></pre></div>
<pre><code>## Rows: 450
## Columns: 9
## $ customerID &lt;chr&gt; &quot;9305-CDSKC&quot;, &quot;4183-MYFRB&quot;, &quot;4080-IIARD&quot;, &quot;5919-TMRGD&quot;, &quot;81…
## $ gender     &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;,…
## $ Contract   &lt;chr&gt; &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Month-to-month&quot;, &quot;Mont…
## $ estrato    &lt;chr&gt; &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-1&quot;, &quot;1-…
## $ .pred_Yes  &lt;dbl&gt; 0.7530790, 0.4527031, 0.4551335, 0.6721531, 0.2751320, 0.39…
## $ ID_unit    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …
## $ Prob       &lt;dbl&gt; 0.4973545, 0.4973545, 0.4973545, 0.4973545, 0.4973545, 0.49…
## $ Stratum    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ factor     &lt;dbl&gt; 2.010638, 2.010638, 2.010638, 2.010638, 2.010638, 2.010638,…</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="a-b---testing.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(muestra_estratificada_2, <span class="st">&quot;data/muestra_estratificada_2.csv&quot;</span>, <span class="at">row.names =</span> F)</span></code></pre></div>
<p>Estos dos conjuntos muestrales son compartidos con el área de marketing para que a cada uno de ellos les ofrezcan de manera independiente una promoción de retención. <strong>Posteriormente, podremos realizar pruebas de hipótesis para muestras independientes</strong> o implementar alguna otra metodología estadística.</p>
</div>
</div>
<div id="estimación-muestral" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Estimación muestral<a href="a-b---testing.html#estimación-muestral" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Es posible que al realizar la captura de forma manual, existan diversos errores, entre los cuales destacan:</p>
<ul>
<li><p>Errores de dedo</p></li>
<li><p>Faltas de ortografía</p></li>
<li><p>Ilegibilidad de respuestas</p></li>
<li><p>Inconsistencias en las respuestas</p></li>
</ul>
<p>Es posible disminuir estos errores cuando el levantamiento se realiza a través de un sistema en donde el capturista eliga la opción de respuesta y no se preste a errores.</p>
<div id="implementación-de-diseño-muestral" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Implementación de diseño muestral<a href="a-b---testing.html#implementación-de-diseño-muestral" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Habiendo recibido los resultados, es importante crear el diseño de muestreo en <em>R</em> que permite iniciar el análisis de resultados de acuerdo con la ponderación que cada unidad de muestreo obtuvo en el diseño muestral.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="a-b---testing.html#cb368-1" aria-hidden="true" tabindex="-1"></a>resultados_promocion_1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/muestra_estratificada_1.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb368-2"><a href="a-b---testing.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">Churn =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>), <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.65</span>)),</span>
<span id="cb368-3"><a href="a-b---testing.html#cb368-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">promotion =</span> <span class="st">&quot;descount&quot;</span>)</span>
<span id="cb368-4"><a href="a-b---testing.html#cb368-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-5"><a href="a-b---testing.html#cb368-5" aria-hidden="true" tabindex="-1"></a>resultados_promocion_2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/muestra_estratificada_2.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb368-6"><a href="a-b---testing.html#cb368-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">Churn =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>), <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.85</span>)),</span>
<span id="cb368-7"><a href="a-b---testing.html#cb368-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">promotion =</span> <span class="st">&quot;cell phone&quot;</span>)</span>
<span id="cb368-8"><a href="a-b---testing.html#cb368-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-9"><a href="a-b---testing.html#cb368-9" aria-hidden="true" tabindex="-1"></a>resultados_promocion <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(resultados_promocion_1, resultados_promocion_2)</span></code></pre></div>
<p>Lo primero, es indicar el diseño muestral usado. En <em>R</em>, existe una librería de nombre <em>srvyr</em> que facilita los análisis de resultados muestrales:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="a-b---testing.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb369-2"><a href="a-b---testing.html#cb369-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-3"><a href="a-b---testing.html#cb369-3" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> resultados_promocion <span class="sc">%&gt;%</span> </span>
<span id="cb369-4"><a href="a-b---testing.html#cb369-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(</span>
<span id="cb369-5"><a href="a-b---testing.html#cb369-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> customerID,</span>
<span id="cb369-6"><a href="a-b---testing.html#cb369-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights =</span> factor,</span>
<span id="cb369-7"><a href="a-b---testing.html#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> estrato,</span>
<span id="cb369-8"><a href="a-b---testing.html#cb369-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pps =</span> <span class="st">&quot;brewer&quot;</span>,</span>
<span id="cb369-9"><a href="a-b---testing.html#cb369-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">variance =</span> <span class="st">&quot;HT&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-10"><a href="a-b---testing.html#cb369-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb369-11"><a href="a-b---testing.html#cb369-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb369-12"><a href="a-b---testing.html#cb369-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicates =</span> <span class="dv">1000</span></span>
<span id="cb369-13"><a href="a-b---testing.html#cb369-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb369-14"><a href="a-b---testing.html#cb369-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-15"><a href="a-b---testing.html#cb369-15" aria-hidden="true" tabindex="-1"></a>design</span></code></pre></div>
<pre><code>## Call: Called via srvyr
## Survey bootstrap with 1000 replicates.
## Data variables: customerID (chr), gender (chr), Contract (chr), estrato (chr),
##   .pred_Yes (dbl), ID_unit (dbl), Prob (dbl), Stratum (dbl), factor (dbl),
##   Churn (chr), promotion (chr)</code></pre>
</div>
<div id="estimación-de-resultados" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Estimación de resultados<a href="a-b---testing.html#estimación-de-resultados" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El diseño de muestreo ha sido creado. Por lo que a partir de este momento comenzaremos a hacer estimaciones estadísticas. Es importante mencionar que la técnica de estimación de resultados corresponde al estimador <a href="https://www150.statcan.gc.ca/n1/pub/12-001-x/2013001/article/11831/section2-eng.htm">Horvitz-Thompson</a>, el cual se calcula de la siguiente forma:</p>
<p><span class="math display">\[\hat{Y}=\sum_{i=1}^{n}{\frac{X_i}{\pi_i}}=\sum_{i=1}^{n}{X_i \cdot F_i}\]</span>
<strong>Donde:</strong></p>
<p><span class="math inline">\(\hat{Y}=\)</span> Es la estimación de la variable de interés</p>
<p><span class="math inline">\(X_i=\)</span> Es la variable de interés observada en la muestra</p>
<p><span class="math inline">\(\pi_i=\)</span> Es la probabilidad de selección del i-ésimo individuo en la muestra</p>
<p><span class="math inline">\(F_i=\)</span> Es el factor de expansión del i-ésimo individuo. Fué calculado como <span class="math inline">\(\frac{1}{\pi_i}\)</span></p>
<p>En el caso de proporciones o estimadores de razón, el cálculo se realiza a través de:</p>
<p><span class="math display">\[\hat{P} = \frac{\hat{Y}}{\hat{N}}; \quad \quad \hat{R} = \frac{\hat{Y}}{\hat{X}}\]</span></p>
<p>Ahora sí, procedemos a realizar estas estimaciones en <em>R</em> para conocer los resultados de interés. La variable <strong>Churn</strong> contiene la pregunta de interés: <em>¿El cliente canceló su servicio?</em> El resultado se muestra a continuación:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="a-b---testing.html#cb371-1" aria-hidden="true" tabindex="-1"></a>design <span class="sc">%&gt;%</span> </span>
<span id="cb371-2"><a href="a-b---testing.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Churn) <span class="sc">%&gt;%</span> </span>
<span id="cb371-3"><a href="a-b---testing.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb371-4"><a href="a-b---testing.html#cb371-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> <span class="fu">survey_prop</span>(</span>
<span id="cb371-5"><a href="a-b---testing.html#cb371-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb371-6"><a href="a-b---testing.html#cb371-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="fu">c</span>(<span class="st">&quot;ci&quot;</span>, <span class="st">&quot;cv&quot;</span>),</span>
<span id="cb371-7"><a href="a-b---testing.html#cb371-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">level =</span> <span class="fl">0.95</span>,</span>
<span id="cb371-8"><a href="a-b---testing.html#cb371-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span></span>
<span id="cb371-9"><a href="a-b---testing.html#cb371-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb371-10"><a href="a-b---testing.html#cb371-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   Churn  prop prop_low prop_upp prop_cv
##   &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 No    0.720    0.689    0.749  0.0209
## 2 Yes   0.280    0.251    0.311  0.0538</code></pre>
<p>Podemos observar que en los resultados obtenemos la proporción puntual y su intervalo de confianza al 95%. Obtenemos también la varianza estimada de nuestra estimación y el <strong>coeficiente de variación</strong>. Esta última métrica nos permite saber la precisión y confiabilidad de la estimación. En la literatura suelde decirse que de acuerdo al nivel obtenido en este valor, podemos determinar la calidad de estimación:</p>
<ol style="list-style-type: decimal">
<li><p>CV &lt; 0.05 <span class="math inline">\(---&gt;\)</span> Excelente</p></li>
<li><p>CV &lt; 0.10 <span class="math inline">\(---&gt;\)</span> Muy bueno</p></li>
<li><p>CV &lt; 0.15 <span class="math inline">\(---&gt;\)</span> Bueno</p></li>
<li><p>CV &lt; 0.25 <span class="math inline">\(---&gt;\)</span> Regular</p></li>
<li><p>CV &gt; 0.25 <span class="math inline">\(---&gt;\)</span> Malo</p></li>
</ol>
<p>La clasificación usada anteriormente es una guía. Deberá entenderse únicamente como una sugerencia y no como una regla absoluta. Este criterio suele variar de investigador a investigador.</p>
<div id="estimación-cruzada" class="section level4 hasAnchor" number="8.5.2.1">
<h4><span class="header-section-number">8.5.2.1</span> Estimación cruzada<a href="a-b---testing.html#estimación-cruzada" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Es muy común querer analizar los resultados de manera cruzada con alguna variable de interés. A continuación, se presentará el ejemplo de cómo estimar resultados de la tasa de cancelación de acuerdo con el método promocional ofertado.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="a-b---testing.html#cb373-1" aria-hidden="true" tabindex="-1"></a>estimation_1 <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb373-2"><a href="a-b---testing.html#cb373-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(promotion, Churn) <span class="sc">%&gt;%</span> </span>
<span id="cb373-3"><a href="a-b---testing.html#cb373-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb373-4"><a href="a-b---testing.html#cb373-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> <span class="fu">survey_prop</span>(</span>
<span id="cb373-5"><a href="a-b---testing.html#cb373-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb373-6"><a href="a-b---testing.html#cb373-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="fu">c</span>(<span class="st">&quot;ci&quot;</span>, <span class="st">&quot;cv&quot;</span>),</span>
<span id="cb373-7"><a href="a-b---testing.html#cb373-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">level =</span> <span class="fl">0.95</span>,</span>
<span id="cb373-8"><a href="a-b---testing.html#cb373-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span></span>
<span id="cb373-9"><a href="a-b---testing.html#cb373-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb373-10"><a href="a-b---testing.html#cb373-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb373-11"><a href="a-b---testing.html#cb373-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb373-12"><a href="a-b---testing.html#cb373-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;prop_&quot;</span>)), round, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb373-13"><a href="a-b---testing.html#cb373-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-14"><a href="a-b---testing.html#cb373-14" aria-hidden="true" tabindex="-1"></a>estimation_1</span></code></pre></div>
<pre><code>## # A tibble: 4 × 6
##   promotion  Churn  prop prop_low prop_upp prop_cv
##   &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 cell phone No    0.836    0.796    0.869   0.022
## 2 cell phone Yes   0.164    0.131    0.204   0.113
## 3 descount   No    0.605    0.557    0.651   0.04 
## 4 descount   Yes   0.395    0.349    0.443   0.061</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="a-b---testing.html#cb375-1" aria-hidden="true" tabindex="-1"></a>estimation_1 <span class="sc">%&gt;%</span> </span>
<span id="cb375-2"><a href="a-b---testing.html#cb375-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Churn, <span class="at">y =</span> prop, <span class="at">ymin =</span> prop_low, <span class="at">ymax =</span> prop_upp, <span class="at">fill =</span> Churn)) <span class="sc">+</span></span>
<span id="cb375-3"><a href="a-b---testing.html#cb375-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb375-4"><a href="a-b---testing.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb375-5"><a href="a-b---testing.html#cb375-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(prop)), <span class="at">y =</span> <span class="fl">0.05</span>,  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb375-6"><a href="a-b---testing.html#cb375-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb375-7"><a href="a-b---testing.html#cb375-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">aesthetics =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;Yes&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb375-8"><a href="a-b---testing.html#cb375-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>promotion) <span class="sc">+</span></span>
<span id="cb375-9"><a href="a-b---testing.html#cb375-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Percentage&quot;</span>) <span class="sc">+</span></span>
<span id="cb375-10"><a href="a-b---testing.html#cb375-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Churn rate by groups&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-254-1.png" width="672" /></p>
<p>En caso de que se dessen analizar los resultados mediante una combinación de variables, solo es necesario agregarlas a la agrupación. A continuación, se muestra un ejemplo de agregación por resultado y sexo:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="a-b---testing.html#cb376-1" aria-hidden="true" tabindex="-1"></a>estimation_2 <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb376-2"><a href="a-b---testing.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(promotion, gender, Churn) <span class="sc">%&gt;%</span> </span>
<span id="cb376-3"><a href="a-b---testing.html#cb376-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb376-4"><a href="a-b---testing.html#cb376-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">survey_total</span>(</span>
<span id="cb376-5"><a href="a-b---testing.html#cb376-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> T,</span>
<span id="cb376-6"><a href="a-b---testing.html#cb376-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">vartype =</span> <span class="cn">NULL</span></span>
<span id="cb376-7"><a href="a-b---testing.html#cb376-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb376-8"><a href="a-b---testing.html#cb376-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> <span class="fu">survey_prop</span>(</span>
<span id="cb376-9"><a href="a-b---testing.html#cb376-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb376-10"><a href="a-b---testing.html#cb376-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="fu">c</span>(<span class="st">&quot;ci&quot;</span>, <span class="st">&quot;cv&quot;</span>),</span>
<span id="cb376-11"><a href="a-b---testing.html#cb376-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">level =</span> <span class="fl">0.95</span>,</span>
<span id="cb376-12"><a href="a-b---testing.html#cb376-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span></span>
<span id="cb376-13"><a href="a-b---testing.html#cb376-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb376-14"><a href="a-b---testing.html#cb376-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb376-15"><a href="a-b---testing.html#cb376-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb376-16"><a href="a-b---testing.html#cb376-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">round</span>(total)) <span class="sc">%&gt;%</span> </span>
<span id="cb376-17"><a href="a-b---testing.html#cb376-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;prop_&quot;</span>)), round, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb376-18"><a href="a-b---testing.html#cb376-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb376-19"><a href="a-b---testing.html#cb376-19" aria-hidden="true" tabindex="-1"></a>estimation_2</span></code></pre></div>
<pre><code>## # A tibble: 8 × 8
##   promotion  gender Churn total  prop prop_low prop_upp prop_cv
##   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 cell phone Female No      717 0.834    0.793    0.868   0.023
## 2 cell phone Female Yes     143 0.166    0.132    0.207   0.115
## 3 cell phone Male   No       38 0.864    0.001    1       0.088
## 4 cell phone Male   Yes       6 0.136    0        0.999   0.558
## 5 descount   Female No      267 0.616    0.548    0.679   0.054
## 6 descount   Female Yes     167 0.384    0.321    0.452   0.087
## 7 descount   Male   No      281 0.595    0.529    0.656   0.054
## 8 descount   Male   Yes     192 0.405    0.344    0.471   0.08</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="a-b---testing.html#cb378-1" aria-hidden="true" tabindex="-1"></a>estimation_2 <span class="sc">%&gt;%</span> </span>
<span id="cb378-2"><a href="a-b---testing.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Churn, <span class="at">y =</span> prop, <span class="at">ymin =</span> prop_low, <span class="at">ymax =</span> prop_upp, <span class="at">fill =</span> Churn)) <span class="sc">+</span></span>
<span id="cb378-3"><a href="a-b---testing.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-4"><a href="a-b---testing.html#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb378-5"><a href="a-b---testing.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(prop)), <span class="at">y =</span> <span class="fl">0.15</span>,  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb378-6"><a href="a-b---testing.html#cb378-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-7"><a href="a-b---testing.html#cb378-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">aesthetics =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;Yes&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb378-8"><a href="a-b---testing.html#cb378-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> promotion <span class="sc">+</span> gender, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb378-9"><a href="a-b---testing.html#cb378-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Percentage&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-10"><a href="a-b---testing.html#cb378-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Churn rate by groups and gender&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-256-1.png" width="672" />
Aparentemente con el método por descuento la polarización en la tasa de cancelación es más grande para hombres que para mujeres, no obstante, debieran realizarse pruebas de hipótesis de tomar una decisión en cuanto a la proposición mencionada.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="a-b---testing.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb379-2"><a href="a-b---testing.html#cb379-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-3"><a href="a-b---testing.html#cb379-3" aria-hidden="true" tabindex="-1"></a>design_2 <span class="ot">&lt;-</span> resultados_promocion <span class="sc">%&gt;%</span> </span>
<span id="cb379-4"><a href="a-b---testing.html#cb379-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb379-5"><a href="a-b---testing.html#cb379-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Churn =</span> <span class="fu">as.factor</span>(Churn),</span>
<span id="cb379-6"><a href="a-b---testing.html#cb379-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">promotion =</span> <span class="fu">as.factor</span>(promotion),</span>
<span id="cb379-7"><a href="a-b---testing.html#cb379-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">as.factor</span>(gender),</span>
<span id="cb379-8"><a href="a-b---testing.html#cb379-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb379-9"><a href="a-b---testing.html#cb379-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>customerID, <span class="at">weights=</span><span class="sc">~</span>factor, <span class="at">data=</span>.)</span>
<span id="cb379-10"><a href="a-b---testing.html#cb379-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-11"><a href="a-b---testing.html#cb379-11" aria-hidden="true" tabindex="-1"></a>glm_design <span class="ot">&lt;-</span> <span class="fu">as.svrepdesign</span>(design_2, <span class="at">type =</span> <span class="st">&quot;bootstrap&quot;</span>)</span>
<span id="cb379-12"><a href="a-b---testing.html#cb379-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-13"><a href="a-b---testing.html#cb379-13" aria-hidden="true" tabindex="-1"></a>glm_design <span class="sc">%&gt;%</span> </span>
<span id="cb379-14"><a href="a-b---testing.html#cb379-14" aria-hidden="true" tabindex="-1"></a><span class="fu">svyglm</span>(<span class="at">design =</span> ., Churn <span class="sc">~</span> promotion <span class="sc">+</span> .pred_Yes <span class="sc">+</span> gender, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb379-15"><a href="a-b---testing.html#cb379-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## svyglm(design = ., formula = Churn ~ promotion + .pred_Yes + 
##     gender, family = &quot;binomial&quot;)
## 
## Survey design:
## as.svrepdesign.default(design_2, type = &quot;bootstrap&quot;)
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -1.88766    0.24519  -7.699 8.25e-10 ***
## promotiondescount  1.18369    0.17719   6.680 2.75e-08 ***
## .pred_Yes          0.51299    0.37900   1.354    0.183    
## genderMale         0.06659    0.17034   0.391    0.698    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 903.0685)
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Los resultados de este modelo buscan implementar un ajuste que explique la decisión de cancelar o no su servicio a través del tipo de promoción aplicado y las características de interés como sexo o alguna otra variable de interés.</p>
<div class="infobox note">
<p><strong>¡¡ EJERCICIO !!</strong></p>
<p>Calcula la diferencia en el beneficio económico para la empresa entre las distintas promociones aplicadas y concluye resultados</p>
</div>

</div>
</div>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

$('.pipehover_incremental tr').hover(function() {
  $(this).removeClass()
  $(this).prevAll().removeClass()
  $(this).nextAll().removeClass()
  $(this).addClass('hover');
  $(this).prevAll().addClass('hover');
  $(this).closest('div').next().find('img').attr("src", $(this).attr("link"));
});


$('.pipehover_select_one_row tr').hover(function() {
  $(this).removeClass()
  $(this).prevAll().removeClass()
  $(this).nextAll().removeClass()
  $(this).addClass('hover');
  $(this).closest('div').next().find('img').attr("src", $(this).attr("link"));
});

</script>
            </section>

          </div>
        </div>
      </div>
<a href="interpretabilidad-de-modelos.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["amt22_03intro2mls2.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
