<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 2 Feature Engineering | AMAT- Ciencia de Datos y Machine Learning 2</title>
  <meta name="description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 2 Feature Engineering | AMAT- Ciencia de Datos y Machine Learning 2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 2 Feature Engineering | AMAT- Ciencia de Datos y Machine Learning 2" />
  
  <meta name="twitter:description" content="AMAT Curso 2 : Ciencia de Datos y Machine Learning 2" />
  

<meta name="author" content="Karina Lizette Gamboa Puente" />
<meta name="author" content="Oscar Arturo Bringas López" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="repaso.html"/>
<link rel="next" href="support-vector-machine-svm-svr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><img src="img/amat-logo.png" width="280"></a></li|
|:-:|  
<center>Ciencia de Datos y Machine Learning 2</center>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>BIENVENIDA</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objetivo"><i class="fa fa-check"></i>Objetivo</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructores"><i class="fa fa-check"></i>Instructores</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ciencia-de-datos-en-r"><i class="fa fa-check"></i>Ciencia de Datos en R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-curso-actual"><i class="fa fa-check"></i>Estructura del curso actual</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#alcances-del-curso"><i class="fa fa-check"></i>Alcances del curso</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#duración-y-evaluación-del-curso"><i class="fa fa-check"></i>Duración y evaluación del curso</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recursos-y-dinámica-de-clase"><i class="fa fa-check"></i>Recursos y dinámica de clase</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="repaso.html"><a href="repaso.html"><i class="fa fa-check"></i><b>1</b> Repaso</a>
<ul>
<li class="chapter" data-level="1.1" data-path="repaso.html"><a href="repaso.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="repaso.html"><a href="repaso.html#tipos-de-aprendizaje"><i class="fa fa-check"></i><b>1.2</b> Tipos de aprendizaje</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="repaso.html"><a href="repaso.html#aprendizaje-supervisado"><i class="fa fa-check"></i><b>1.2.1</b> Aprendizaje supervisado</a></li>
<li class="chapter" data-level="1.2.2" data-path="repaso.html"><a href="repaso.html#aprendizaje-no-supervisado"><i class="fa fa-check"></i><b>1.2.2</b> Aprendizaje no supervisado</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="repaso.html"><a href="repaso.html#errores-sesgo-vs-varianza"><i class="fa fa-check"></i><b>1.3</b> Errores: Sesgo vs varianza</a></li>
<li class="chapter" data-level="1.4" data-path="repaso.html"><a href="repaso.html#partición-de-datos"><i class="fa fa-check"></i><b>1.4</b> Partición de datos</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="repaso.html"><a href="repaso.html#métodos-comunes-para-particionar-datos"><i class="fa fa-check"></i><b>1.4.1</b> Métodos comunes para particionar datos</a></li>
<li class="chapter" data-level="1.4.2" data-path="repaso.html"><a href="repaso.html#conjunto-de-validación"><i class="fa fa-check"></i><b>1.4.2</b> Conjunto de validación</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="repaso.html"><a href="repaso.html#recetas-y-tratamiento-de-datos"><i class="fa fa-check"></i><b>1.5</b> Recetas y tratamiento de datos</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="repaso.html"><a href="repaso.html#pre-procesamiento-de-datos"><i class="fa fa-check"></i><b>1.5.1</b> Pre-procesamiento de datos</a></li>
<li class="chapter" data-level="1.5.2" data-path="repaso.html"><a href="repaso.html#recetas"><i class="fa fa-check"></i><b>1.5.2</b> Recetas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>2</b> Feature Engineering</a>
<ul>
<li class="chapter" data-level="2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#regresión-polinomial"><i class="fa fa-check"></i><b>2.1</b> Regresión polinomial</a></li>
<li class="chapter" data-level="2.2" data-path="feature-engineering.html"><a href="feature-engineering.html#análisis-de-componentes-principales"><i class="fa fa-check"></i><b>2.2</b> Análisis de Componentes Principales</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#eigenvalores-y-eigenvectores"><i class="fa fa-check"></i><b>2.2.1</b> Eigenvalores y eigenvectores</a></li>
<li class="chapter" data-level="2.2.2" data-path="feature-engineering.html"><a href="feature-engineering.html#implementación-en-r"><i class="fa fa-check"></i><b>2.2.2</b> Implementación en R</a></li>
<li class="chapter" data-level="2.2.3" data-path="feature-engineering.html"><a href="feature-engineering.html#representación-gráfica"><i class="fa fa-check"></i><b>2.2.3</b> Representación gráfica</a></li>
<li class="chapter" data-level="2.2.4" data-path="feature-engineering.html"><a href="feature-engineering.html#cuántas-componentes-retener"><i class="fa fa-check"></i><b>2.2.4</b> ¿Cuántas componentes retener?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="feature-engineering.html"><a href="feature-engineering.html#imputación-knn"><i class="fa fa-check"></i><b>2.3</b> Imputación KNN</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="feature-engineering.html"><a href="feature-engineering.html#ventajas-y-limitaciones-del-clasificador-knn"><i class="fa fa-check"></i><b>2.3.1</b> <strong>Ventajas y limitaciones del Clasificador KNN</strong></a></li>
<li class="chapter" data-level="2.3.2" data-path="feature-engineering.html"><a href="feature-engineering.html#implementación-en-r-1"><i class="fa fa-check"></i><b>2.3.2</b> Implementación en R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="feature-engineering.html"><a href="feature-engineering.html#ejercicios"><i class="fa fa-check"></i><b>2.4</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html"><i class="fa fa-check"></i><b>3</b> Support Vector Machine (SVM / SVR)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#maximum-margin-classifier"><i class="fa fa-check"></i><b>3.1</b> Maximum Margin Classifier</a></li>
<li class="chapter" data-level="3.2" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-classifiers"><i class="fa fa-check"></i><b>3.2</b> Support Vector Classifiers</a></li>
<li class="chapter" data-level="3.3" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-machine"><i class="fa fa-check"></i><b>3.3</b> Support Vector Machine</a></li>
<li class="chapter" data-level="3.4" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#el-truco-del-kernel"><i class="fa fa-check"></i><b>3.4</b> El truco del Kernel</a></li>
<li class="chapter" data-level="3.5" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#support-vector-regression"><i class="fa fa-check"></i><b>3.5</b> Support Vector Regression</a></li>
<li class="chapter" data-level="3.6" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ventajas-y-desventajas"><i class="fa fa-check"></i><b>3.6</b> Ventajas y desventajas</a></li>
<li class="chapter" data-level="3.7" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ajuste-del-modelo-con-r"><i class="fa fa-check"></i><b>3.7</b> Ajuste del modelo con R</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#implementación-de-svr-en-r"><i class="fa fa-check"></i><b>3.7.1</b> Implementación de SVR en R</a></li>
<li class="chapter" data-level="3.7.2" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#implementación-de-svm-en-r"><i class="fa fa-check"></i><b>3.7.2</b> Implementación de SVM en R</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="support-vector-machine-svm-svr.html"><a href="support-vector-machine-svm-svr.html#ejercicios-1"><i class="fa fa-check"></i><b>3.8</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="./"><img src="img/amat-logo.png" width="280"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AMAT- Ciencia de Datos y Machine Learning 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="feature-engineering" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Capítulo 2</span> Feature Engineering<a href="feature-engineering.html#feature-engineering" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="regresión-polinomial" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Regresión polinomial<a href="feature-engineering.html#regresión-polinomial" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Es común encontrar en la literatura este tema junto con la regresión múltiple, sin embargo, el alcance de esta transformación va a más allá de la regresión lineal, por lo que estudiaremos este tema como parte de la ingeniería de variables y no como un modelo lineal exclusivamente.</p>
<p>El objetivo de la transformación polinomial dentro de la ingeniería de variables es crear nuevas variables que puedan explicar la relación entre la variable de respuesta y explicativa a través de un polinomio de grado <em>k</em>.</p>
<p>En el siguiente gráfico se representa mediante una línea roja a la regresión lineal y mediante una curva azul al polinomio que relaciona a las variables independiente y dependiente.</p>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Es evidente que existe un mejor ajuste cuando se considera un polinomio de grado <em>k</em> en vez de la componente lineal. Este método ofrece mayor flexibilidad para el ajuste de un modelo. Será importante <strong>mediar posteriormente entre el sesgo y la varianza</strong> de forma que podamos tener un mejor ajuste sin caer en el sobreajuste. La fórmula que expresa la relación entre variable de respuesta y explicativas es ahora:</p>
<p><span class="math display">\[Y_i \sim X_1 + X_1^2\]</span></p>
<p>Es importante mencionar que cuando se ajusta un modelo polinomial de segundo orden, se deben mantener ambas variables en el model (la original y la cuadrática). Cuando se tenga un modelo polinomial de grado <em>k</em>, se deberán conservar los <em>k</em> elementos que componen el polinomio:</p>
<p><span class="math display">\[Y\sim X_1+X_1^2 + ... + X_1^k\]</span></p>
<p>Estas transformaciones son posibles realizarlas a múltiples variables que conforman el conjunto de datos que sirve de insumo para el modelo. A través de los pasos secuenciales en las recetas podemos integrar esta tarea a través de la función <code>step_poly( )</code>. Veamos un ejemplo:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="feature-engineering.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb6-2"><a href="feature-engineering.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="feature-engineering.html#cb6-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb6-4"><a href="feature-engineering.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb6-5"><a href="feature-engineering.html#cb6-5" aria-hidden="true" tabindex="-1"></a>original_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">lengt=</span>n)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="feature-engineering.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x<span class="sc">^</span><span class="dv">3</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">100</span>))</span>
<span id="cb6-7"><a href="feature-engineering.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="feature-engineering.html#cb6-8" aria-hidden="true" tabindex="-1"></a>poly_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(y <span class="sc">~</span> x, <span class="at">data =</span> original_data) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="feature-engineering.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(x, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="feature-engineering.html#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb6-11"><a href="feature-engineering.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="feature-engineering.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(poly_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 100 × 4
##        y x_poly_1 x_poly_2 x_poly_3
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 -941.   -0.171    0.217  -0.249 
##  2 -870.   -0.168    0.204  -0.219 
##  3 -895.   -0.165    0.191  -0.190 
##  4 -874.   -0.161    0.178  -0.163 
##  5 -716.   -0.158    0.166  -0.137 
##  6 -908.   -0.154    0.154  -0.113 
##  7 -616.   -0.151    0.142  -0.0904
##  8 -661.   -0.147    0.131  -0.0690
##  9 -618.   -0.144    0.119  -0.0489
## 10 -640.   -0.140    0.108  -0.0302
## # … with 90 more rows</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="feature-engineering.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(poly_recipe) <span class="sc">%&gt;%</span> <span class="fu">lm</span>(y <span class="sc">~</span> x_poly_1 <span class="sc">+</span> x_poly_2 <span class="sc">+</span> x_poly_3, <span class="at">data =</span> .)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x_poly_1 + x_poly_2 + x_poly_3, data = .)
## 
## Coefficients:
## (Intercept)     x_poly_1     x_poly_2     x_poly_3  
##       24.52      3643.95       -34.12      1541.84</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="feature-engineering.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(poly_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="feature-engineering.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="feature-engineering.html#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">lengt=</span>n),</span>
<span id="cb10-4"><a href="feature-engineering.html#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_est =</span> <span class="fl">24.52</span> <span class="sc">+</span> <span class="fl">3643.95</span> <span class="sc">*</span> x_poly_1 <span class="sc">-</span><span class="fl">34.12</span> <span class="sc">*</span> x_poly_2 <span class="sc">+</span> <span class="fl">1541.84</span> <span class="sc">*</span> x_poly_3) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="feature-engineering.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb10-6"><a href="feature-engineering.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-7"><a href="feature-engineering.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_est)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="feature-engineering.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Regresión polinomial&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>En el ejemplo anterior puede mostrarse que es a través de la ponderación de los términos polinomiales que se logra estimar a la variable de respuesta <em>Y</em>.</p>
<p>Este mismo procedimiento puede usarse en la receta de la ingeniería de datos para realizar la predicción de una variable de respuesta mediante cualquier otro algoritmo predictivo.</p>
</div>
<div id="análisis-de-componentes-principales" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Análisis de Componentes Principales<a href="feature-engineering.html#análisis-de-componentes-principales" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>El análisis PCA (por sus siglas en inglés) es una <strong>técnica de reducción de dimensión</strong> útil tanto para el proceso de análisis exploratorio, el inferencial y predictivo. Es una técnica ampliamente usada en muchos estudios, pues permite sintetizar la información relevante y desechar aquello que no aporta tanto. Es particularmente útil en el caso de conjuntos de datos “amplios” en donde las <strong>variables están correlacionadas entre sí</strong> y donde se tienen muchas variables para cada observación.</p>
<p>En los conjuntos de datos donde hay muchas variables presentes, no es fácil trazar los datos en su formato original, lo que dificulta tener una idea de las tendencias presentes en ellos. PCA permite ver la estructura general de los datos, identificando qué observaciones son similares entre sí y cuáles son diferentes. Esto puede permitirnos identificar grupos de muestras que son similares y determinar qué variables hacen a un grupo diferente de otro.</p>
<p>La idea detrás de esta técnica es la siguiente:</p>
<ul>
<li>Se desean crear nuevas variables llamadas <strong>Componentes Principales</strong>, las cuales son creadas como combinación lineal (transformación lineal) de las variables originales, por lo que cada una de las variables nuevas contiene parcialmente información de todas las variables originales.</li>
</ul>
<p><span class="math display">\[Z_1 = a_{11}X_1 +a_{12}X_2 + ... + a_{1p}X_p\]</span>
<span class="math display">\[Z_2 = a_{21}X_1 +a_{22}X_2 + ... + a_{2p}X_p\]</span>
<span class="math display">\[...\]</span>
<span class="math display">\[Z_p = a_{p1}X_1 +a_{p2}X_2 + ... + a_{pp}X_p\]</span></p>
<ul>
<li>Se desea que la primer componente principal capture la mayor varianza posible de todo el conjunto de datos.</li>
</ul>
<p><span class="math display">\[\forall i \in 2,...,p \quad Var(Z_1)&gt;Var(Z_i)\]</span></p>
<ul>
<li>La segunda componente principal deberá <strong>SER INDEPENDIENTE</strong> de la primera y deberá abarcar la mayor varianza posible del restante. Esta condición se debe cumplir para toda componente <em>i</em>, de tal forma que las nuevas componentes creadas son independientes entre sí y acumulan la mayor proporción de varianza en las primeras de ellas, dejando la mínima proporción de varianza a las últimas componentes.</li>
</ul>
<p><span class="math display">\[Z_1 \perp\!\!\!\perp Z_2 \quad \&amp; \quad Var(Z_1)&gt;Var(Z_2)&gt;Var(Z_i)\]</span></p>
<ul>
<li>El punto anterior permite desechar unas cuantas componentes (las últimas) sin perder mucha varianza.</li>
</ul>
<div class="infobox note">
<p><strong>¡¡ RECORDAR !!</strong></p>
<ul>
<li><p><strong>A través de CPA se logra retener la mayor cantidad de varianza útil pero usando menos componentes que el número de variables originales.</strong></p></li>
<li><p><strong>Para que este proceso sea efectivo, debe existir ALTA correlación entre las variables originales.</strong></p></li>
</ul>
</div>
<p>Cuando muchas variables se correlacionan entre sí, todas contribuirán fuertemente al mismo componente principal. Cada componente principal suma un cierto porcentaje de la variación total en el conjunto de datos. Cuando sus variables iniciales estén fuertemente correlacionadas entre sí y podrá aproximar la mayor parte de la complejidad de su conjunto de datos con solo unos pocos componentes principales.</p>
<p>Agregar componentes adicionales hace que la estimación del conjunto de datos total sea más precisa, pero también más difícil de manejar.</p>
<div id="eigenvalores-y-eigenvectores" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Eigenvalores y eigenvectores<a href="feature-engineering.html#eigenvalores-y-eigenvectores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Los vectores propios y los valores propios vienen en pares: <strong>cada vector propio tiene un valor propio correspondiente</strong>. Los vectores propios son la ponderación que permite crear la combinación lineal de las variables para conformar cada componente principal, mientras que el valor propio es la varianza asociada a cada componente principal. Desde un punto de vista geométrico, el eigenvector es la dirección del vector determinado por la componente principal y el eigenvalor es la magnitud de dicho vector.</p>
<div class="infobox pin">
<ul>
<li><p>El valor propio de una componente es la varianza de este.</p></li>
<li><p>La suma acumulada de los primeros <span class="math inline">\(j\)</span> eigenvalores representa la varianza acumulada de las primeras <span class="math inline">\(j\)</span> componentes principales</p></li>
</ul>
</div>
<p>El número de valores propios y vectores propios que existe es igual al número de dimensiones que tiene el conjunto de datos.</p>
</div>
<div id="implementación-en-r" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Implementación en R<a href="feature-engineering.html#implementación-en-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="feature-engineering.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-2"><a href="feature-engineering.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb11-3"><a href="feature-engineering.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb11-4"><a href="feature-engineering.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="feature-engineering.html#cb11-5" aria-hidden="true" tabindex="-1"></a>indice_marg <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;data/IMEF_2010.dbf&#39;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="feature-engineering.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(indice_marg)</span></code></pre></div>
<pre><code>## Rows: 32
## Columns: 16
## $ CVE_ENT &lt;chr&gt; &quot;01&quot;, &quot;02&quot;, &quot;03&quot;, &quot;04&quot;, &quot;05&quot;, &quot;06&quot;, &quot;07&quot;, &quot;08&quot;, &quot;09&quot;, &quot;10&quot;, &quot;1…
## $ AÑO     &lt;int&gt; 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 20…
## $ POB_TOT &lt;int&gt; 1184996, 3155070, 637026, 822441, 2748391, 650555, 4796580, 34…
## $ ANALF   &lt;dbl&gt; 3.274040, 2.600783, 3.234464, 8.370643, 2.645050, 5.157943, 17…
## $ SPRIM   &lt;dbl&gt; 14.754823, 12.987567, 14.273833, 22.541207, 12.168029, 18.4761…
## $ OVSDE   &lt;dbl&gt; 1.0649743, 0.4322072, 0.9436751, 6.4196750, 1.0916308, 0.68577…
## $ OVSEE   &lt;dbl&gt; 0.62347891, 0.94517891, 2.84464884, 2.59080046, 0.53707721, 0.…
## $ OVSAE   &lt;dbl&gt; 0.9854257, 3.5616214, 7.0865085, 9.7378176, 1.3908497, 1.17060…
## $ VHAC    &lt;dbl&gt; 30.33066, 29.05839, 31.73806, 45.96720, 30.26891, 31.32052, 53…
## $ OVPT    &lt;dbl&gt; 1.761813, 3.398537, 5.814081, 4.500699, 1.423701, 4.691477, 15…
## $ PL_5000 &lt;dbl&gt; 25.1626166, 10.3491523, 15.6188287, 30.8755279, 12.1486353, 14…
## $ PO2SM   &lt;dbl&gt; 33.64880, 21.86970, 23.29986, 45.51076, 30.04270, 32.04402, 69…
## $ IM      &lt;dbl&gt; -0.91086057, -1.14014880, -0.68128749, 0.43357139, -1.14000448…
## $ GM      &lt;chr&gt; &quot;Bajo&quot;, &quot;Muy bajo&quot;, &quot;Bajo&quot;, &quot;Alto&quot;, &quot;Muy bajo&quot;, &quot;Bajo&quot;, &quot;Muy a…
## $ LUGAR   &lt;int&gt; 28, 30, 23, 10, 29, 26, 2, 21, 32, 15, 14, 1, 6, 27, 22, 8, 19…
## $ NOM_ENT &lt;chr&gt; &quot;Aguascalientes&quot;, &quot;Baja California&quot;, &quot;Baja California Sur&quot;, &quot;C…</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="feature-engineering.html#cb13-1" aria-hidden="true" tabindex="-1"></a>indice_marg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(GM, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##         GM n
## 1    Medio 9
## 2     Alto 8
## 3     Bajo 8
## 4 Muy bajo 4
## 5 Muy alto 3</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="feature-engineering.html#cb15-1" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(IM <span class="sc">~</span> ., <span class="at">data =</span> indice_marg) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="feature-engineering.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(NOM_ENT, GM, <span class="at">new_role =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="feature-engineering.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="feature-engineering.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM, <span class="at">num_comp=</span><span class="dv">9</span>, <span class="at">res=</span><span class="st">&quot;res&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="feature-engineering.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(LUGAR, AÑO, POB_TOT) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="feature-engineering.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb15-7"><a href="feature-engineering.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="feature-engineering.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(pca_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 13
##    CVE_ENT GM     NOM_ENT      IM    PC1     PC2     PC3     PC4     PC5     PC6
##    &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 01      Bajo   Aguasc… -0.911  -2.34  -0.227   0.372   0.492   0.264   0.0764
##  2 02      Muy b… Baja C… -1.14   -2.93   0.595  -0.0597 -0.492   0.291  -0.0508
##  3 03      Bajo   Baja C… -0.681  -1.75   1.37   -0.683  -0.400  -0.304   0.160 
##  4 04      Alto   Campec…  0.434   1.12  -0.819  -0.151  -0.271  -0.929   0.178 
##  5 05      Muy b… Coahui… -1.14   -2.93  -0.144   0.157  -0.133   0.0419 -0.0786
##  6 06      Bajo   Colima  -0.779  -2.00   0.0316  0.552  -0.136   0.320  -0.729 
##  7 07      Muy a… Chiapas  2.32    5.96   0.132   1.36   -0.0122 -0.673  -0.471 
##  8 08      Bajo   Chihua… -0.520  -1.34   1.05   -1.27    0.633  -0.646  -0.387 
##  9 09      Muy b… Distri… -1.48   -3.81   0.110   0.159  -0.453   0.205  -0.355 
## 10 10      Medio  Durango  0.0525  0.135  0.675  -1.50    0.929  -0.448   0.146 
## # … with 22 more rows, and 3 more variables: PC7 &lt;dbl&gt;, PC8 &lt;dbl&gt;, PC9 &lt;dbl&gt;</code></pre>
<p>Veamos los pasos de esta receta:</p>
<ul>
<li><p>Primero, debemos decirle a la receta qué datos se usan para predecir la variable de respuesta.</p></li>
<li><p>Se actualiza el rol de las variables <em>nombre de entidad</em> y <em>grado de marginación</em> con la función <code>NOM_ENT</code>, ya que es una variable que queremos mantener por conveniencia como identificador de filas, pero no son un predictor ni variable de respuesta.</p></li>
<li><p>Necesitamos centrar y escalar los predictores numéricos, porque estamos a punto de implementar <strong>PCA</strong>.</p></li>
<li><p>Finalmente, usamos <code>step_pca()</code> para realizar el análisis de componentes principales.</p></li>
<li><p>La función <code>prep()</code> es la que realiza toda la preparación de la receta.</p></li>
</ul>
<p>Una vez que hayamos hecho eso, podremos explorar los resultados del <strong>PCA</strong>. Comencemos por ver cómo resultó el <strong>PCA</strong>. Podemos ordenar los resultados mediante la función <code>tidy()</code>, incluido el paso de <strong>PCA</strong>, que es el segundo paso. Luego hagamos una visualización para ver cómo se ven los componentes.</p>
<p>A continuación se muestran la desviación estándar, porcentaje de varianza y porcentaje de varianza acumulada que aporta cada componente principal.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="feature-engineering.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_recipe<span class="sc">$</span>steps[[<span class="dv">2</span>]]<span class="sc">$</span>res)</span></code></pre></div>
<pre><code>## Importance of components:
##                          PC1     PC2    PC3     PC4     PC5     PC6     PC7
## Standard deviation     2.572 0.82085 0.7920 0.64640 0.52101 0.44069 0.31797
## Proportion of Variance 0.735 0.07487 0.0697 0.04643 0.03016 0.02158 0.01123
## Cumulative Proportion  0.735 0.80990 0.8796 0.92603 0.95619 0.97777 0.98900
##                            PC8     PC9
## Standard deviation     0.25660 0.18201
## Proportion of Variance 0.00732 0.00368
## Cumulative Proportion  0.99632 1.00000</code></pre>
<p>Podemos observar que en la primera componente principal, las <span class="math inline">\(9\)</span> variables que utilizó el Consejo Nacional de Población para obtener el <a href="http://www.conapo.gob.mx/work/models/CONAPO/Resource/862/4/images/06_C_AGEB.pdf">Índice de Marginación 2010</a> aportan de manera positiva en el primer componente principal.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="feature-engineering.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb19-2"><a href="feature-engineering.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="feature-engineering.html#cb19-3" aria-hidden="true" tabindex="-1"></a>tidied_pca <span class="ot">&lt;-</span> <span class="fu">tidy</span>(pca_recipe, <span class="dv">2</span>)</span>
<span id="cb19-4"><a href="feature-engineering.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="feature-engineering.html#cb19-5" aria-hidden="true" tabindex="-1"></a>tidied_pca <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="feature-engineering.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(component <span class="sc">%in%</span> <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="feature-engineering.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(component) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="feature-engineering.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">9</span>, <span class="fu">abs</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="feature-engineering.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="feature-engineering.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">terms =</span> <span class="fu">reorder_within</span>(terms, <span class="fu">abs</span>(value), component)) <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="feature-engineering.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">abs</span>(value), terms, <span class="at">fill =</span> value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="feature-engineering.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb19-13"><a href="feature-engineering.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>component, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="feature-engineering.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb19-15"><a href="feature-engineering.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-16"><a href="feature-engineering.html#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Absolute value of contribution&quot;</span>,</span>
<span id="cb19-17"><a href="feature-engineering.html#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">&quot;Positive?&quot;</span></span>
<span id="cb19-18"><a href="feature-engineering.html#cb19-18" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb19-19"><a href="feature-engineering.html#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Notamos que las <span class="math inline">\(9\)</span> variables aportan entre el <span class="math inline">\(25\%\)</span> y el <span class="math inline">\(35\%\)</span> a la
primera componente principal.</p>
</div>
<div id="representación-gráfica" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Representación gráfica<a href="feature-engineering.html#representación-gráfica" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="feature-engineering.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb20-2"><a href="feature-engineering.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="feature-engineering.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(pca_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="feature-engineering.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GM =</span> <span class="fu">factor</span>(GM, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Muy alto&quot;</span>, <span class="st">&quot;Alto&quot;</span>, <span class="st">&quot;Medio&quot;</span>, <span class="st">&quot;Bajo&quot;</span>, <span class="st">&quot;Muy bajo&quot;</span>)), </span>
<span id="cb20-5"><a href="feature-engineering.html#cb20-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="feature-engineering.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2, <span class="at">label =</span> NOM_ENT)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="feature-engineering.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> GM), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="feature-engineering.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>() <span class="sc">+</span></span>
<span id="cb20-9"><a href="feature-engineering.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Grado de marginación de entidades&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Finalmente, podemos observar como (de izquierda a derecha) los estados con grado de marginación Muy bajo, Bajo, Medio, Alto y Muy Alto respectivamente.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="feature-engineering.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(pca_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="feature-engineering.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> IM, <span class="at">y =</span> PC1)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="feature-engineering.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="feature-engineering.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="feature-engineering.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Comparación: Índice Marginación Vs PCA CP1&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="cuántas-componentes-retener" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> ¿Cuántas componentes retener?<a href="feature-engineering.html#cuántas-componentes-retener" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Existe en la literatura basta información sobre el número de componentes a retener en un análisis de PCA. El siguiente gráfico lleva por nombre <strong>gráfico de codo</strong> y muestra el porcentaje de varianza explicado por cada componente principal.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="feature-engineering.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb23-2"><a href="feature-engineering.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb23-3"><a href="feature-engineering.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="feature-engineering.html#cb23-4" aria-hidden="true" tabindex="-1"></a>res.pca <span class="ot">&lt;-</span> indice_marg <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="feature-engineering.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="feature-engineering.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="feature-engineering.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_rownames</span>(indice_marg<span class="sc">$</span>NOM_ENT) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="feature-engineering.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">PCA</span>(<span class="at">graph=</span><span class="cn">FALSE</span>)</span>
<span id="cb23-9"><a href="feature-engineering.html#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="feature-engineering.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(res.pca, <span class="at">addlabels=</span><span class="cn">TRUE</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>El grafico anterior muestra que hay una diferencia muy grande entre la varianza retenida por la 1er componente principal y el resto de las variables. Dependiendo del objetivo del analisis podra elegirse el numero adecuado de componentes a retener, no obstante, la literatura sugiere retener 1 o 2 componentes principales.</p>
<p>Regresando al tema de <strong>feature engineering</strong>, es posible realizar el proceso de componentes principales y elegir una de las dos opciones siguientes:</p>
<ol style="list-style-type: decimal">
<li><p>Especificar el número de componentes a retener</p></li>
<li><p>Indicar el porcentaje de varianza a alcanzar</p></li>
</ol>
<p>La segunda opción elegirá tantas componentes como sean necesarias hasta alcanzar el hiperparámetro mínimo indicado. A continuación se ejemplifica:</p>
<p><strong>Caso 1:</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="feature-engineering.html#cb24-1" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(IM <span class="sc">~</span> ., <span class="at">data =</span> indice_marg) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="feature-engineering.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(NOM_ENT, GM, <span class="at">new_role =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="feature-engineering.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="feature-engineering.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM,<span class="at">num_comp=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="feature-engineering.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(LUGAR, AÑO, POB_TOT) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="feature-engineering.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb24-7"><a href="feature-engineering.html#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="feature-engineering.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(pca_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 6
##    CVE_ENT GM       NOM_ENT                   IM    PC1     PC2
##    &lt;fct&gt;   &lt;fct&gt;    &lt;fct&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 01      Bajo     Aguascalientes       -0.911  -2.34  -0.227 
##  2 02      Muy bajo Baja California      -1.14   -2.93   0.595 
##  3 03      Bajo     Baja California Sur  -0.681  -1.75   1.37  
##  4 04      Alto     Campeche              0.434   1.12  -0.819 
##  5 05      Muy bajo Coahuila de Zaragoza -1.14   -2.93  -0.144 
##  6 06      Bajo     Colima               -0.779  -2.00   0.0316
##  7 07      Muy alto Chiapas               2.32    5.96   0.132 
##  8 08      Bajo     Chihuahua            -0.520  -1.34   1.05  
##  9 09      Muy bajo Distrito Federal     -1.48   -3.81   0.110 
## 10 10      Medio    Durango               0.0525  0.135  0.675 
## # … with 22 more rows</code></pre>
<p><strong>Caso 2:</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="feature-engineering.html#cb26-1" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(IM <span class="sc">~</span> ., <span class="at">data =</span> indice_marg) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="feature-engineering.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(NOM_ENT, GM, <span class="at">new_role =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="feature-engineering.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="feature-engineering.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(ANALF, SPRIM, OVSDE, OVSEE, OVSAE, VHAC, OVPT, PL_5000, PO2SM,<span class="at">threshold=</span><span class="fl">0.90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="feature-engineering.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(LUGAR, AÑO, POB_TOT) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="feature-engineering.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb26-7"><a href="feature-engineering.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="feature-engineering.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">juice</span>(pca_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 8
##    CVE_ENT GM       NOM_ENT                   IM    PC1     PC2     PC3     PC4
##    &lt;fct&gt;   &lt;fct&gt;    &lt;fct&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 01      Bajo     Aguascalientes       -0.911  -2.34  -0.227   0.372   0.492 
##  2 02      Muy bajo Baja California      -1.14   -2.93   0.595  -0.0597 -0.492 
##  3 03      Bajo     Baja California Sur  -0.681  -1.75   1.37   -0.683  -0.400 
##  4 04      Alto     Campeche              0.434   1.12  -0.819  -0.151  -0.271 
##  5 05      Muy bajo Coahuila de Zaragoza -1.14   -2.93  -0.144   0.157  -0.133 
##  6 06      Bajo     Colima               -0.779  -2.00   0.0316  0.552  -0.136 
##  7 07      Muy alto Chiapas               2.32    5.96   0.132   1.36   -0.0122
##  8 08      Bajo     Chihuahua            -0.520  -1.34   1.05   -1.27    0.633 
##  9 09      Muy bajo Distrito Federal     -1.48   -3.81   0.110   0.159  -0.453 
## 10 10      Medio    Durango               0.0525  0.135  0.675  -1.50    0.929 
## # … with 22 more rows</code></pre>
<p>Así es como usaremos el análisis de componentes principales para mejorar la estructura de variables que sirven de input para cualquiera de los modelos posteriores. Continuaremos con un paso más de pre-procesamiento antes de comenzar a aprender nuevos modelos.</p>
</div>
</div>
<div id="imputación-knn" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Imputación KNN<a href="feature-engineering.html#imputación-knn" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Antes de aprender el uso de la función de imputación, recordaremos brevemente como funciona el algoritmo de K-Nearest-Neighbor (KNN)</p>
<p>KNN es un algoritmo de aprendizaje supervisado que podemos usar tanto para regresión como clasificación. Es un algoritmo fácil de interpretar y que permite ser flexible en el balance entre sesgo y varianza (dependiendo de los hiper-parámetros seleccionados).</p>
<p>El algoritmo de K vecinos más cercanos realiza comparaciones entre un nuevo elemento y las observaciones anteriores que ya cuentan con etiqueta. La esencia de este algoritmo está en <strong>etiquetar a un nuevo elemento de manera similar a como están etiquetados aquellos <em>K</em> elementos que más se le parecen</strong>. Veremos este proceso para cada uno de los posibles casos:</p>
<p><img src="img/04-ml/knn3.gif" width="800pt" height="400pt" style="display: block; margin: auto;" /></p>
<div id="ventajas-y-limitaciones-del-clasificador-knn" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> <strong>Ventajas y limitaciones del Clasificador KNN</strong><a href="feature-engineering.html#ventajas-y-limitaciones-del-clasificador-knn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Ventajas:</strong></p>
<ul>
<li>KNN no hace ninguna suposición subyacente sobre los datos.</li>
<li>Con la adición de más puntos de datos, el clasificador evoluciona constantemente y es capaz de adaptarse rápidamente a los cambios en el conjunto de datos de entrada.</li>
<li>Le da al usuario la flexibilidad de elegir la <a href="https://www.maartengrootendorst.com/blog/distances/">métrica de medida de distancia</a>.</li>
</ul>
<p><strong>Desventajas:</strong></p>
<ul>
<li>KNN es muy sensible a los valores atípicos.</li>
<li>No funciona con datos faltantes.</li>
<li>A medida que crece el conjunto de datos, la clasificación se vuelve más lenta.</li>
<li>Existe la llamada maldición de la dimensionalidad.</li>
</ul>
<p>Este algoritmo es altamente usado para imputación de datos faltantes, ¿tiene lógica, cierto?, con <strong>recipes</strong> podemos aplicar un paso con la función: <strong><em>step_impute_knn</em></strong> antes llamada <strong><em>step_knnimpute()</em></strong>, podemos observar la documentación de la función en el siguiente <a href="https://recipes.tidymodels.org/reference/step_impute_knn.html">enlace</a>.</p>
</div>
<div id="implementación-en-r-1" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Implementación en R<a href="feature-engineering.html#implementación-en-r-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Veámos cómo implementar la imputación por <em>KNN</em> para datos faltantes en <em>R</em>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="feature-engineering.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step_impute_knn</span>(</span>
<span id="cb28-2"><a href="feature-engineering.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  recipe,</span>
<span id="cb28-3"><a href="feature-engineering.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  ...,                                        <span class="do">### Variables a imputar</span></span>
<span id="cb28-4"><a href="feature-engineering.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">neighbors =</span> <span class="dv">5</span>,</span>
<span id="cb28-5"><a href="feature-engineering.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">impute_with =</span> <span class="fu">imp_vars</span>(<span class="fu">all_predictors</span>()),</span>
<span id="cb28-6"><a href="feature-engineering.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rand_id</span>(<span class="st">&quot;impute_knn&quot;</span>)</span>
<span id="cb28-7"><a href="feature-engineering.html#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Acerca de los parámetros:</p>
<ul>
<li><p><em>neighbors:</em> Número de vecinos</p></li>
<li><p><em>impute_with:</em> Una llamada a <em>imp_vars</em> para especificar qué variables se usan para imputar las variables. Si una columna se incluye en ambas listas para ser imputada y para ser un predictor de imputación, se eliminará de esta última y no se usará para imputarse a sí misma.</p></li>
<li><p><em>id:</em> Una cadena de caracteres que es exclusiva de este paso para identificarlo.</p></li>
</ul>
<p>La función utiliza el conjunto de entrenamiento para imputar cualquier otro conjunto de datos. La única función de distancia disponible es la distancia de <strong>Gower</strong>, que se puede utilizar para combinaciones de datos nominales y numéricos.</p>
<div class="infobox note">
<p><em>Acerca de <strong>Gower</strong></em> El coeficiente de similitud de Gower propuesto en 1971 permite la manipulación simultánea de variables cuantitativas y cualitativas en una base de datos, mediante la aplicación de este coeficiente se logra hallar la similitud entre individuos a los cuales se les han medido una serie de características en común. Una similaridad alta, es decir cercana a 1, indicara gran homogeneidad entre los individuos; por el contrario, una similaridad cercana a cero indica que los individuos son diferentes</p>
</div>
<p>Vamos a utilizar los datos de <em>biomass</em> de la libreria <em>modeldata</em> que
contiene un conjunto de datos donde diferentes combustibles de biomasa se caracterizan por la cantidad de ciertas moléculas (carbono, hidrógeno, oxígeno, nitrógeno y azufre) y el poder calorífico superior correspondiente (HHV). En esta base hemos retirado valores aleatoriamente sobre dos variables para realizar el ejercicio.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="feature-engineering.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb29-2"><a href="feature-engineering.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata)</span>
<span id="cb29-3"><a href="feature-engineering.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb29-4"><a href="feature-engineering.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(biomass)</span>
<span id="cb29-5"><a href="feature-engineering.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="feature-engineering.html#cb29-6" aria-hidden="true" tabindex="-1"></a>biomass_te_whole <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(biomass)</span>
<span id="cb29-7"><a href="feature-engineering.html#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="feature-engineering.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># induce some missing data at random</span></span>
<span id="cb29-9"><a href="feature-engineering.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19735</span>)</span>
<span id="cb29-10"><a href="feature-engineering.html#cb29-10" aria-hidden="true" tabindex="-1"></a>carb_missing <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(biomass_te_whole), <span class="dv">75</span>)</span>
<span id="cb29-11"><a href="feature-engineering.html#cb29-11" aria-hidden="true" tabindex="-1"></a>nitro_missing <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(biomass_te_whole), <span class="dv">75</span>)</span>
<span id="cb29-12"><a href="feature-engineering.html#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="feature-engineering.html#cb29-13" aria-hidden="true" tabindex="-1"></a>biomass_te_whole<span class="sc">$</span>carbon[carb_missing] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb29-14"><a href="feature-engineering.html#cb29-14" aria-hidden="true" tabindex="-1"></a>biomass_te_whole<span class="sc">$</span>nitrogen[nitro_missing] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb29-15"><a href="feature-engineering.html#cb29-15" aria-hidden="true" tabindex="-1"></a>biomass_te_whole[<span class="st">&quot;carb_imputed&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;No&quot;</span></span>
<span id="cb29-16"><a href="feature-engineering.html#cb29-16" aria-hidden="true" tabindex="-1"></a>biomass_te_whole<span class="sc">$</span>carb_imputed[carb_missing] <span class="ot">&lt;-</span> <span class="st">&quot;Yes&quot;</span></span>
<span id="cb29-17"><a href="feature-engineering.html#cb29-17" aria-hidden="true" tabindex="-1"></a>biomass_te_whole[<span class="st">&quot;nitro_imputed&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;No&quot;</span></span>
<span id="cb29-18"><a href="feature-engineering.html#cb29-18" aria-hidden="true" tabindex="-1"></a>biomass_te_whole<span class="sc">$</span>nitro_imputed[nitro_missing] <span class="ot">&lt;-</span> <span class="st">&quot;Yes&quot;</span></span>
<span id="cb29-19"><a href="feature-engineering.html#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="feature-engineering.html#cb29-20" aria-hidden="true" tabindex="-1"></a>biomass_tr <span class="ot">&lt;-</span> biomass_te_whole <span class="sc">%&gt;%</span> <span class="fu">filter</span>( dataset <span class="sc">==</span> <span class="st">&#39;Training&#39;</span>)</span>
<span id="cb29-21"><a href="feature-engineering.html#cb29-21" aria-hidden="true" tabindex="-1"></a>biomass_te <span class="ot">&lt;-</span> biomass_te_whole <span class="sc">%&gt;%</span> <span class="fu">filter</span>( dataset <span class="sc">==</span> <span class="st">&quot;Testing&quot;</span>) </span>
<span id="cb29-22"><a href="feature-engineering.html#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="feature-engineering.html#cb29-23" aria-hidden="true" tabindex="-1"></a>biomass_te_whole[nitro_missing,]</span></code></pre></div>
<pre><code>## # A tibble: 75 × 10
##    sample      dataset carbon hydrogen oxygen nitrogen sulfur   HHV carb_imputed
##    &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
##  1 Red Alder … Traini…   49.6     6.06   43.8       NA   0.07  19.3 No          
##  2 Cereals, H… Traini…   44.8     5      42.5       NA   0.13  18.4 No          
##  3 Sewage Slu… Traini…   28.3     4.07   17.5       NA   1.25  12.1 No          
##  4 Palm Fibre  Testing   47.5     6.01   36.4       NA   0.3   19.2 No          
##  5 Rice Straw  Traini…   35.7     4.62   39.1       NA   0     14.8 No          
##  6 Prune Pits  Traini…   49.3     6.59   41.8       NA   0.07  20.1 No          
##  7 Ryegrass S… Traini…   46.7     5.8    41.9       NA   0.2   18.5 No          
##  8 Peanut Hul… Traini…   45.8     5.46   39.6       NA   0.12  18.6 No          
##  9 Cereals, H… Traini…   NA       4.9    43.1       NA   0.12  18.2 Yes         
## 10 Erco Char   Traini…   65.9     2.57   12.8       NA   0.1   24.2 No          
## # … with 65 more rows, and 1 more variable: nitro_imputed &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="feature-engineering.html#cb31-1" aria-hidden="true" tabindex="-1"></a>biomass_tr <span class="sc">%&gt;%</span> DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>( <span class="at">title =</span> <span class="st">&quot;Train&quot;</span> )</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="feature-engineering.html#cb32-1" aria-hidden="true" tabindex="-1"></a>biomass_te <span class="sc">%&gt;%</span> DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>( <span class="at">title =</span> <span class="st">&quot;Test&quot;</span> )</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<p>En la primera opción vamos a aplicar el paso de immputación indicando qué columnas quieren ser imputadas y con cuáles variables queremos que se haga el proceso.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="feature-engineering.html#cb33-1" aria-hidden="true" tabindex="-1"></a>recipe_esp <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb33-2"><a href="feature-engineering.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  HHV <span class="sc">~</span> carbon <span class="sc">+</span> hydrogen <span class="sc">+</span> oxygen <span class="sc">+</span> nitrogen <span class="sc">+</span> sulfur, </span>
<span id="cb33-3"><a href="feature-engineering.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> biomass_tr) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="feature-engineering.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(</span>
<span id="cb33-5"><a href="feature-engineering.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    carbon, nitrogen,</span>
<span id="cb33-6"><a href="feature-engineering.html#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">impute_with=</span> <span class="fu">imp_vars</span>(hydrogen, oxygen),</span>
<span id="cb33-7"><a href="feature-engineering.html#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-8"><a href="feature-engineering.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb33-9"><a href="feature-engineering.html#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="feature-engineering.html#cb33-10" aria-hidden="true" tabindex="-1"></a>imputed_esp_train <span class="ot">&lt;-</span> <span class="fu">bake</span>(recipe_esp, biomass_tr)</span>
<span id="cb33-11"><a href="feature-engineering.html#cb33-11" aria-hidden="true" tabindex="-1"></a>imputed_esp_test <span class="ot">&lt;-</span> <span class="fu">bake</span>(recipe_esp, biomass_te) <span class="do">## Probando la receta con un test</span></span>
<span id="cb33-12"><a href="feature-engineering.html#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="feature-engineering.html#cb33-13" aria-hidden="true" tabindex="-1"></a>imputed_esp_train <span class="sc">%&gt;%</span> DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>( <span class="at">title =</span> <span class="st">&quot;Imputacion Train&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="feature-engineering.html#cb34-1" aria-hidden="true" tabindex="-1"></a>imputed_esp_test <span class="sc">%&gt;%</span> DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>(<span class="at">title =</span> <span class="st">&quot;Imputacion Test&quot;</span>)</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<p>Sin embargo, siempre podemos pedirle al modelo que haga la imputación de todas las variables que tengan nulos, con toda la información de las demás variables disponibles (no nulas).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="feature-engineering.html#cb35-1" aria-hidden="true" tabindex="-1"></a>recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb35-2"><a href="feature-engineering.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  HHV <span class="sc">~</span> carbon <span class="sc">+</span> hydrogen <span class="sc">+</span> oxygen <span class="sc">+</span> nitrogen <span class="sc">+</span> sulfur, </span>
<span id="cb35-3"><a href="feature-engineering.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> biomass_tr) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="feature-engineering.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>(), <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="feature-engineering.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb35-6"><a href="feature-engineering.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="feature-engineering.html#cb35-7" aria-hidden="true" tabindex="-1"></a>imputed <span class="ot">&lt;-</span> <span class="fu">bake</span>(recipe, biomass_te) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="feature-engineering.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(biomass_te <span class="sc">%&gt;%</span> <span class="fu">select</span>(carb_imputed, nitro_imputed)) <span class="co"># prueba con test</span></span>
<span id="cb35-9"><a href="feature-engineering.html#cb35-9" aria-hidden="true" tabindex="-1"></a>imputed <span class="sc">%&gt;%</span> DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>()</span></code></pre></div>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-36-1.png" width="672" /><img src="amt22_03intro2mls2_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
</div>
</div>
<div id="ejercicios" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Ejercicios<a href="feature-engineering.html#ejercicios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Cada equipo estará a cargo de desarrollar una receta de <em>feature engineering</em> utilizando los pasos vistos en el curso pasado y el actual.</p></li>
<li><p>Tendrán 15 días para probar distintas estrategias que mejoren las predicciones del precio de ventas.</p></li>
<li><p>Se deberá entregar y explicar el código creado por el equipo. Este código servirá para los ejercicios de optimización de modelos en los siguientes capítulos.</p></li>
</ol>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

$('.pipehover_incremental tr').hover(function() {
  $(this).removeClass()
  $(this).prevAll().removeClass()
  $(this).nextAll().removeClass()
  $(this).addClass('hover');
  $(this).prevAll().addClass('hover');
  $(this).closest('div').next().find('img').attr("src", $(this).attr("link"));
});


$('.pipehover_select_one_row tr').hover(function() {
  $(this).removeClass()
  $(this).prevAll().removeClass()
  $(this).nextAll().removeClass()
  $(this).addClass('hover');
  $(this).closest('div').next().find('img').attr("src", $(this).attr("link"));
});

</script>
            </section>

          </div>
        </div>
      </div>
<a href="repaso.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="support-vector-machine-svm-svr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["amt22_03intro2mls2.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
